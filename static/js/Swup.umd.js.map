{"version":3,"file":"Swup.umd.js","sources":["../src/helpers/classify.ts","../src/helpers/getCurrentUrl.ts","../src/helpers/updateHistoryRecord.ts","../node_modules/delegate-it/delegate.js","../src/helpers/delegateEvent.ts","../src/utils/index.ts","../src/helpers/Location.ts","../src/helpers/markSwupElements.ts","../src/helpers/cleanupAnimationClasses.ts","../src/modules/Cache.ts","../src/modules/enterPage.ts","../src/modules/getAnchorElement.ts","../src/modules/getAnimationPromises.ts","../src/modules/getPageData.ts","../src/helpers/getDataFromHtml.ts","../src/modules/fetchPage.ts","../src/helpers/fetch.ts","../src/modules/leavePage.ts","../src/modules/loadPage.ts","../src/helpers/createHistoryRecord.ts","../src/modules/replaceContent.ts","../src/modules/events.ts","../src/modules/plugins.ts","../src/modules/renderPage.ts","../src/modules/transitions.ts","../src/Swup.ts"],"sourcesContent":["export const classify = (text: string, fallback?: string): string => {\n\tconst output = String(text)\n\t\t.toLowerCase()\n\t\t// .normalize('NFD') // split an accented letter in the base letter and the acent\n\t\t// .replace(/[\\u0300-\\u036f]/g, '') // remove all previously split accents\n\t\t.replace(/[\\s/_.]+/g, '-') // replace spaces and _./ with '-'\n\t\t.replace(/[^\\w-]+/g, '') // remove all non-word chars\n\t\t.replace(/--+/g, '-') // replace repeating '-' with single '-'\n\t\t.replace(/^-+|-+$/g, ''); // trim '-' from edges\n\treturn output || fallback || '';\n};\n","export const getCurrentUrl = ({ hash }: { hash?: boolean } = {}): string => {\n\treturn location.pathname + location.search + (hash ? location.hash : '');\n};\n","import { getCurrentUrl } from './getCurrentUrl.js';\n\nexport const updateHistoryRecord = (\n\turl: string | null = null,\n\tcustomData: Record<string, unknown> = {}\n): void => {\n\turl = url || getCurrentUrl({ hash: true });\n\tconst data = {\n\t\t...history.state,\n\t\turl,\n\t\trandom: Math.random(),\n\t\tsource: 'swup',\n\t\t...customData\n\t};\n\thistory.replaceState(data, '', url);\n};\n","/** Keeps track of raw listeners added to the base elements to avoid duplication */\nconst ledger = new WeakMap();\nfunction editLedger(wanted, baseElement, callback, setup) {\n    if (!wanted && !ledger.has(baseElement)) {\n        return false;\n    }\n    const elementMap = ledger.get(baseElement)\n        ?? new WeakMap();\n    ledger.set(baseElement, elementMap);\n    const setups = elementMap.get(callback) ?? new Set();\n    elementMap.set(callback, setups);\n    const existed = setups.has(setup);\n    if (wanted) {\n        setups.add(setup);\n    }\n    else {\n        setups.delete(setup);\n    }\n    return existed && wanted;\n}\nfunction safeClosest(event, selector) {\n    let target = event.target;\n    if (target instanceof Text) {\n        target = target.parentElement;\n    }\n    if (target instanceof Element && event.currentTarget instanceof Element) {\n        // `.closest()` may match ancestors of `currentTarget` but we only need its children\n        const closest = target.closest(selector);\n        if (closest && event.currentTarget.contains(closest)) {\n            return closest;\n        }\n    }\n}\n// This type isn't exported as a declaration, so it needs to be duplicated above\nfunction delegate(selector, type, callback, options = {}) {\n    const { signal, base = document } = options;\n    if (signal?.aborted) {\n        return;\n    }\n    // Don't pass `once` to `addEventListener` because it needs to be handled in `delegate-it`\n    const { once, ...nativeListenerOptions } = options;\n    // `document` should never be the base, it's just an easy way to define \"global event listeners\"\n    const baseElement = base instanceof Document ? base.documentElement : base;\n    // Handle the regular Element usage\n    const capture = Boolean(typeof options === 'object' ? options.capture : options);\n    const listenerFn = (event) => {\n        const delegateTarget = safeClosest(event, selector);\n        if (delegateTarget) {\n            const delegateEvent = Object.assign(event, { delegateTarget });\n            callback.call(baseElement, delegateEvent);\n            if (once) {\n                baseElement.removeEventListener(type, listenerFn, nativeListenerOptions);\n                editLedger(false, baseElement, callback, setup);\n            }\n        }\n    };\n    const setup = JSON.stringify({ selector, type, capture });\n    const isAlreadyListening = editLedger(true, baseElement, callback, setup);\n    if (!isAlreadyListening) {\n        baseElement.addEventListener(type, listenerFn, nativeListenerOptions);\n    }\n    signal?.addEventListener('abort', () => {\n        editLedger(false, baseElement, callback, setup);\n    });\n}\nexport default delegate;\n","import delegate, { DelegateEventHandler, DelegateOptions, EventType } from 'delegate-it';\nimport { ParseSelector } from 'typed-query-selector/parser.js';\n\nexport type Unsubscribe = {\n\tdestroy: () => void;\n};\n\nexport const delegateEvent = <Selector extends string, TEvent extends EventType>(\n\tselector: Selector,\n\ttype: TEvent,\n\tcallback: DelegateEventHandler<GlobalEventHandlersEventMap[TEvent]>,\n\toptions?: DelegateOptions\n): Unsubscribe => {\n\tconst controller = new AbortController();\n\tdelegate<string, ParseSelector<Selector, HTMLElement>, TEvent>(\n\t\tselector,\n\t\ttype,\n\t\tcallback,\n\t\toptions\n\t);\n\treturn { destroy: () => controller.abort() };\n};\n","export const query = (selector: string, context: Document | Element = document) => {\n\treturn context.querySelector<HTMLElement>(selector);\n};\n\nexport const queryAll = (\n\tselector: string,\n\tcontext: Document | Element = document\n): HTMLElement[] => {\n\treturn Array.from(context.querySelectorAll(selector));\n};\n\nexport const nextTick = (callback: () => void) => {\n\trequestAnimationFrame(() => {\n\t\trequestAnimationFrame(() => {\n\t\t\tcallback();\n\t\t});\n\t});\n};\n\nexport const escapeCssIdentifier = (ident: string) => {\n\t// @ts-ignore this is for support check, so it's correct that TS complains\n\tif (window.CSS && window.CSS.escape) {\n\t\treturn CSS.escape(ident);\n\t} else {\n\t\treturn ident;\n\t}\n};\n\n// Fix for Chrome below v61 formatting CSS floats with comma in some locales\nexport const toMs = (s: string) => {\n\treturn Number(s.slice(0, -1).replace(',', '.')) * 1000;\n};\n","/**\n * A helper for creating a Location from either an element\n * or a URL object/string\n *\n */\n\nexport class Location extends URL {\n\tconstructor(url: string, base: string = document.baseURI) {\n\t\tsuper(url.toString(), base);\n\t}\n\n\tget url() {\n\t\treturn this.pathname + this.search;\n\t}\n\n\t/**\n\t * Instantiate a Location from an element's href attribute\n\t * @param {Element} el\n\t * @return new Location instance\n\t */\n\tstatic fromElement(el: HTMLAnchorElement): Location {\n\t\tconst href = el.getAttribute('href') || el.getAttribute('xlink:href');\n\t\treturn new Location(href!);\n\t}\n\n\t/**\n\t * Instantiate a Location from a URL object or string\n\t * @param {URL|string} url\n\t * @return new Location instance\n\t */\n\tstatic fromUrl(url: string): Location {\n\t\treturn new Location(url);\n\t}\n}\n","import { query, queryAll } from '../utils.js';\n\nexport const markSwupElements = (element: Element, containers: string[]): void => {\n\tlet blocks = 0;\n\n\tcontainers.forEach((selector) => {\n\t\tif (query(selector, element) == null) {\n\t\t\tconsole.warn(`[swup] Container ${selector} not found on page.`);\n\t\t} else {\n\t\t\tqueryAll(selector).forEach((item: Element, index: number) => {\n\t\t\t\tqueryAll(selector, element)[index].setAttribute('data-swup', String(blocks));\n\t\t\t\tblocks++;\n\t\t\t});\n\t\t}\n\t});\n};\n","export const isSwupClass = (className: string): boolean =>\n\t/^to-/.test(className) || ['is-changing', 'is-rendering', 'is-popstate'].includes(className);\n\nexport const cleanupAnimationClasses = (): void => {\n\tconst htmlClasses = document.documentElement.className.split(' ');\n\tconst removeClasses = htmlClasses.filter(isSwupClass);\n\tdocument.documentElement.classList.remove(...removeClasses);\n};\n","import { getCurrentUrl, Location } from '../helpers.js';\nimport Swup from '../Swup.js';\nimport { PageData } from './getPageData.js';\n\nexport interface PageRecord extends PageData {\n\turl: string;\n\tresponseURL: string;\n}\nexport class Cache {\n\tpages: Record<string, PageRecord> = {};\n\tlast: PageRecord | null = null;\n\tswup: Swup;\n\n\tconstructor(swup: Swup) {\n\t\tthis.swup = swup;\n\t}\n\n\tgetCacheUrl(url: string): string {\n\t\treturn this.swup.resolveUrl(Location.fromUrl(url).url);\n\t}\n\n\tcacheUrl(page: PageRecord) {\n\t\tpage.url = this.getCacheUrl(page.url);\n\t\tif (page.url in this.pages === false) {\n\t\t\tthis.pages[page.url] = page;\n\t\t}\n\t\tpage.responseURL = this.getCacheUrl(page.responseURL);\n\t\tthis.last = this.pages[page.url];\n\t\tthis.swup.log(`Cache (${Object.keys(this.pages).length})`, this.pages);\n\t}\n\n\tgetPage(url: string): PageRecord {\n\t\turl = this.getCacheUrl(url);\n\t\treturn this.pages[url];\n\t}\n\n\tgetCurrentPage(): PageRecord {\n\t\treturn this.getPage(getCurrentUrl());\n\t}\n\n\texists(url: string): boolean {\n\t\turl = this.getCacheUrl(url);\n\t\treturn url in this.pages;\n\t}\n\n\tempty(): void {\n\t\tthis.pages = {};\n\t\tthis.last = null;\n\t\tthis.swup.log('Cache cleared');\n\t}\n\n\tremove(url: string): void {\n\t\tdelete this.pages[this.getCacheUrl(url)];\n\t}\n}\n","import { nextTick } from '../utils.js';\nimport Swup from '../Swup.js';\nimport { PageRenderOptions } from './renderPage.js';\n\nexport const enterPage = function (this: Swup, { event, skipTransition }: PageRenderOptions = {}) {\n\tif (skipTransition) {\n\t\tthis.triggerEvent('transitionEnd', event);\n\t\tthis.cleanupAnimationClasses();\n\t\treturn [Promise.resolve()];\n\t}\n\n\tnextTick(() => {\n\t\tthis.triggerEvent('animationInStart');\n\t\tdocument.documentElement.classList.remove('is-animating');\n\t});\n\n\tconst animationPromises = this.getAnimationPromises('in');\n\tPromise.all(animationPromises).then(() => {\n\t\tthis.triggerEvent('animationInDone');\n\t\tthis.triggerEvent('transitionEnd', event);\n\t\tthis.cleanupAnimationClasses();\n\t});\n\treturn animationPromises;\n};\n","import { escapeCssIdentifier as escape, query } from '../utils.js';\n\n/**\n * Find the anchor element for a given hash.\n * @see https://html.spec.whatwg.org/#find-a-potential-indicated-element\n *\n * @param hash Hash with or without leading '#'\n * @returns The element, if found, or null.\n */\nexport const getAnchorElement = (hash: string): Element | null => {\n\tif (hash && hash.charAt(0) === '#') {\n\t\thash = hash.substring(1);\n\t}\n\n\tif (!hash) {\n\t\treturn null;\n\t}\n\n\tconst decoded = decodeURIComponent(hash);\n\tlet element =\n\t\tdocument.getElementById(hash) ||\n\t\tdocument.getElementById(decoded) ||\n\t\tquery(`a[name='${escape(hash)}']`) ||\n\t\tquery(`a[name='${escape(decoded)}']`);\n\n\tif (!element && hash === 'top') {\n\t\telement = document.body;\n\t}\n\n\treturn element;\n};\n","import { queryAll, toMs } from '../utils.js';\nimport Swup from '../Swup.js';\n\n// Transition property/event sniffing\nlet transitionProp = 'transition';\nlet transitionEndEvent = 'transitionend';\nlet animationProp = 'animation';\nlet animationEndEvent = 'animationend';\n\nif (window.ontransitionend === undefined && window.onwebkittransitionend !== undefined) {\n\ttransitionProp = 'WebkitTransition';\n\ttransitionEndEvent = 'webkitTransitionEnd';\n}\n\nif (window.onanimationend === undefined && window.onwebkitanimationend !== undefined) {\n\tanimationProp = 'WebkitAnimation';\n\tanimationEndEvent = 'webkitAnimationEnd';\n}\n\nexport function getAnimationPromises(\n\tthis: Swup,\n\t// we don't use this argument, but JS plugin depends on it with\n\t// its own version of getAnimationPromises, so it must be specified when\n\t// getAnimationPromises is being used\n\tanimationType: 'in' | 'out'\n): Promise<void>[] {\n\tconst selector = this.options.animationSelector;\n\n\t// Allow usage of swup without animations\n\tif (selector === false) {\n\t\t// Use array of a single resolved promise instead of an empty array to allow\n\t\t// possible future use with Promise.race() which requires an actual value\n\t\treturn [Promise.resolve()];\n\t}\n\n\tconst animatedElements = queryAll(selector, document.body);\n\n\t// Warn if no elements match the animationSelector, but keep things going\n\tif (!animatedElements.length) {\n\t\tconsole.warn(`[swup] No elements found matching animationSelector \\`${selector}\\``);\n\t\treturn [Promise.resolve()];\n\t}\n\n\tconst animationPromises = animatedElements\n\t\t.map((element) => getAnimationPromiseForElement(element))\n\t\t.filter(Boolean) as Promise<void>[];\n\n\tif (!animationPromises.length) {\n\t\tconsole.warn(\n\t\t\t`[swup] No CSS animation duration defined on elements matching \\`${selector}\\``\n\t\t);\n\t\treturn [Promise.resolve()];\n\t}\n\n\treturn animationPromises;\n}\n\nconst isTransitionOrAnimationEvent = (event: any): event is TransitionEvent | AnimationEvent =>\n\t[transitionEndEvent, animationEndEvent].includes(event.type);\n\nfunction getAnimationPromiseForElement(element: Element): Promise<void> | undefined {\n\tconst { type, timeout, propCount } = getTransitionInfo(element);\n\n\t// Resolve immediately if no transition defined\n\tif (!type || !timeout) {\n\t\treturn undefined;\n\t}\n\n\treturn new Promise((resolve) => {\n\t\tconst endEvent = type === 'transition' ? transitionEndEvent : animationEndEvent;\n\t\tconst startTime = performance.now();\n\t\tlet propsTransitioned = 0;\n\n\t\tconst end = () => {\n\t\t\telement.removeEventListener(endEvent, onEnd);\n\t\t\tresolve();\n\t\t};\n\n\t\tconst onEnd: EventListener = (event) => {\n\t\t\t// Skip transitions on child elements\n\t\t\tif (event.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!isTransitionOrAnimationEvent(event)) {\n\t\t\t\tthrow new Error('Not a transition or animation event.');\n\t\t\t}\n\n\t\t\t// Skip transitions that happened before we started listening\n\t\t\tconst elapsedTime = (performance.now() - startTime) / 1000;\n\t\t\tif (elapsedTime < event.elapsedTime) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// End if all properties have transitioned\n\t\t\tif (++propsTransitioned >= propCount) {\n\t\t\t\tend();\n\t\t\t}\n\t\t};\n\n\t\tsetTimeout(() => {\n\t\t\tif (propsTransitioned < propCount) {\n\t\t\t\tend();\n\t\t\t}\n\t\t}, timeout + 1);\n\n\t\telement.addEventListener(endEvent, onEnd);\n\t});\n}\n\nexport function getTransitionInfo(\n\telement: Element,\n\texpectedType: 'animation' | 'transition' | null = null\n) {\n\tconst styles = window.getComputedStyle(element);\n\n\t// not sure what to do about the below mess other than casting, but it's a mess\n\tconst transitionDelay = `${transitionProp}Delay` as keyof CSSStyleDeclaration;\n\tconst transitionDuration = `${transitionProp}Duration` as keyof CSSStyleDeclaration;\n\tconst animationDelay = `${animationProp}Delay` as keyof CSSStyleDeclaration;\n\tconst animationDuration = `${animationProp}Duration` as keyof CSSStyleDeclaration;\n\n\tconst transitionDelays = (\n\t\tstyles[transitionDelay] as CSSStyleDeclaration['transitionDelay']\n\t).split(', ');\n\tconst transitionDurations = (\n\t\t(styles[transitionDuration] || '') as CSSStyleDeclaration['transitionDuration']\n\t).split(', ');\n\tconst transitionTimeout = calculateTimeout(transitionDelays, transitionDurations);\n\n\tconst animationDelays = (\n\t\t(styles[animationDelay] || '') as CSSStyleDeclaration['animationDelay']\n\t).split(', ');\n\tconst animationDurations = (\n\t\t(styles[animationDuration] || '') as CSSStyleDeclaration['animationDuration']\n\t).split(', ');\n\tconst animationTimeout = calculateTimeout(animationDelays, animationDurations);\n\n\tlet type: string | null = '';\n\tlet timeout = 0;\n\tlet propCount = 0;\n\n\tif (expectedType === 'transition') {\n\t\tif (transitionTimeout > 0) {\n\t\t\ttype = 'transition';\n\t\t\ttimeout = transitionTimeout;\n\t\t\tpropCount = transitionDurations.length;\n\t\t}\n\t} else if (expectedType === 'animation') {\n\t\tif (animationTimeout > 0) {\n\t\t\ttype = 'animation';\n\t\t\ttimeout = animationTimeout;\n\t\t\tpropCount = animationDurations.length;\n\t\t}\n\t} else {\n\t\ttimeout = Math.max(transitionTimeout, animationTimeout);\n\t\ttype =\n\t\t\ttimeout > 0\n\t\t\t\t? transitionTimeout > animationTimeout\n\t\t\t\t\t? 'transition'\n\t\t\t\t\t: 'animation'\n\t\t\t\t: null;\n\t\tpropCount = type\n\t\t\t? type === 'transition'\n\t\t\t\t? transitionDurations.length\n\t\t\t\t: animationDurations.length\n\t\t\t: 0;\n\t}\n\n\treturn {\n\t\ttype,\n\t\ttimeout,\n\t\tpropCount\n\t};\n}\n\nfunction calculateTimeout(delays: string[], durations: string[]) {\n\twhile (delays.length < durations.length) {\n\t\tdelays = delays.concat(delays);\n\t}\n\n\treturn Math.max(...durations.map((duration, i) => toMs(duration) + toMs(delays[i])));\n}\n","import { getDataFromHtml } from '../helpers.js';\nimport Swup from '../Swup.js';\nimport { PageHtmlData } from '../helpers/getDataFromHtml.js';\n\nexport type PageData = PageHtmlData & {\n\tresponseURL: string;\n};\nexport const getPageData = function (this: Swup, request: XMLHttpRequest): PageData | null {\n\t// this method can be replaced in case other content than html is expected to be received from server\n\t// this function should always return { title, pageClass, originalContent, blocks, responseURL }\n\t// in case page has invalid structure - return null\n\tconst html = request.responseText;\n\tconst pageHtmlData = getDataFromHtml(html, this.options.containers);\n\n\tif (!pageHtmlData) {\n\t\tconsole.warn('[swup] Received page is invalid.');\n\t\treturn null;\n\t}\n\n\treturn {\n\t\t...pageHtmlData,\n\t\tresponseURL: request.responseURL || window.location.href\n\t};\n};\n","import { query, queryAll } from '../utils.js';\n\nexport type PageHtmlData = {\n\ttitle: string;\n\toriginalContent: string;\n\tblocks: string[];\n\tpageClass?: string;\n};\n\nexport const getDataFromHtml = (html: string, containers: string[]): PageHtmlData => {\n\tlet fakeDom = document.createElement('html');\n\tfakeDom.innerHTML = html;\n\tlet blocks: string[] = [];\n\n\tcontainers.forEach((selector) => {\n\t\tif (query(selector, fakeDom) == null) {\n\t\t\tconsole.warn(`[swup] Container ${selector} not found on page.`);\n\t\t\treturn null;\n\t\t} else {\n\t\t\tif (queryAll(selector).length !== queryAll(selector, fakeDom).length) {\n\t\t\t\tconsole.warn(`[swup] Mismatched number of containers found on new page.`);\n\t\t\t}\n\t\t\tqueryAll(selector).forEach((item, index) => {\n\t\t\t\tqueryAll(selector, fakeDom)[index].setAttribute('data-swup', String(blocks.length));\n\t\t\t\tblocks.push(queryAll(selector, fakeDom)[index].outerHTML);\n\t\t\t});\n\t\t}\n\t});\n\n\tconst title = query('title', fakeDom)?.innerText || '';\n\tconst pageClass = query('body', fakeDom)?.className;\n\n\t// to prevent memory leaks\n\tfakeDom.innerHTML = '';\n\t// @ts-ignore don't want to type it as possible null, since it's created at the top of the function always\n\tfakeDom = null;\n\n\treturn { title, pageClass, blocks, originalContent: html };\n};\n","import Swup from '../Swup.js';\nimport { fetch } from '../helpers.js';\nimport { TransitionOptions } from './loadPage.js';\nimport { PageRecord } from './Cache.js';\n\nexport function fetchPage(this: Swup, data: TransitionOptions): Promise<PageRecord> {\n\tconst headers = this.options.requestHeaders;\n\tconst { url } = data;\n\n\tif (this.cache.exists(url)) {\n\t\tthis.triggerEvent('pageRetrievedFromCache');\n\t\treturn Promise.resolve(this.cache.getPage(url));\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tfetch({ ...data, headers }, (response) => {\n\t\t\tif (response.status === 500) {\n\t\t\t\tthis.triggerEvent('serverError');\n\t\t\t\treject(url);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// get json data\n\t\t\tconst page = this.getPageData(response);\n\t\t\tif (!page || !page.blocks.length) {\n\t\t\t\treject(url);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// render page\n\t\t\tconst cacheablePageData = { ...page, url };\n\t\t\tthis.cache.cacheUrl(cacheablePageData);\n\t\t\tthis.triggerEvent('pageLoaded');\n\t\t\tresolve(cacheablePageData);\n\t\t});\n\t});\n}\n","import { TransitionOptions } from '../modules/loadPage.js';\nimport { Options } from '../Swup.js';\n\nexport const fetch = (\n\toptions: TransitionOptions & { headers: Options['requestHeaders'] },\n\tcallback: (request: XMLHttpRequest) => void\n): XMLHttpRequest => {\n\tconst defaults = {\n\t\turl: window.location.pathname + window.location.search,\n\t\tmethod: 'GET',\n\t\tdata: null,\n\t\theaders: {}\n\t};\n\n\tconst { url, method, headers, data } = { ...defaults, ...options };\n\n\tconst request = new XMLHttpRequest();\n\n\trequest.onreadystatechange = function () {\n\t\tif (request.readyState === 4) {\n\t\t\t// if (request.status === 500) {} else {}\n\t\t\tcallback(request);\n\t\t}\n\t};\n\n\trequest.open(method, url, true);\n\tObject.entries(headers).forEach(([key, header]) => {\n\t\trequest.setRequestHeader(key, header);\n\t});\n\trequest.send(data);\n\n\treturn request;\n};\n","import Swup from '../Swup.js';\nimport { PageRenderOptions } from './renderPage.js';\n\nexport const leavePage = function (this: Swup, { event, skipTransition }: PageRenderOptions = {}) {\n\tconst isHistoryVisit = event instanceof PopStateEvent;\n\n\tif (skipTransition) {\n\t\tthis.triggerEvent('animationSkipped');\n\t\treturn [Promise.resolve()];\n\t}\n\n\tthis.triggerEvent('animationOutStart');\n\n\t// handle classes\n\tdocument.documentElement.classList.add('is-changing', 'is-leaving', 'is-animating');\n\tif (isHistoryVisit) {\n\t\tdocument.documentElement.classList.add('is-popstate');\n\t}\n\n\t// animation promise stuff\n\tconst animationPromises: Promise<void>[] = this.getAnimationPromises('out');\n\tPromise.all(animationPromises).then(() => {\n\t\tthis.triggerEvent('animationOutDone');\n\t});\n\n\treturn animationPromises;\n};\n","import { classify, createHistoryRecord, updateHistoryRecord, getCurrentUrl } from '../helpers.js';\nimport Swup from '../Swup.js';\nimport { PageRecord } from './Cache.js';\n\nexport type HistoryAction = 'push' | 'replace';\n\nexport type TransitionOptions = {\n\turl: string;\n\tcustomTransition?: string;\n\thistory?: HistoryAction;\n};\n\nexport type PageLoadOptions = {\n\turl: string;\n\tcustomTransition?: string;\n\thistory?: HistoryAction;\n\tevent?: PopStateEvent;\n};\n\nexport function loadPage(this: Swup, data: TransitionOptions) {\n\tconst { url } = data;\n\n\t// Check if the visit should be ignored\n\tif (this.shouldIgnoreVisit(url)) {\n\t\twindow.location.href = url;\n\t} else {\n\t\tthis.performPageLoad(data);\n\t}\n}\n\nexport function performPageLoad(this: Swup, data: PageLoadOptions) {\n\tconst { url, event, customTransition, history: historyAction = 'push' } = data ?? {};\n\n\tconst isHistoryVisit = event instanceof PopStateEvent;\n\tconst skipTransition = this.shouldSkipTransition({ url, event });\n\n\tthis.triggerEvent('transitionStart', event);\n\n\t// set transition object\n\tthis.updateTransition(getCurrentUrl(), url, customTransition);\n\tif (customTransition != null) {\n\t\tdocument.documentElement.classList.add(`to-${classify(customTransition)}`);\n\t}\n\n\t// start/skip animation\n\tconst animationPromises = this.leavePage({ event, skipTransition });\n\n\t// Load page data\n\tconst fetchPromise = this.fetchPage(data);\n\n\t// create history record if this is not a popstate call (with or without anchor)\n\tif (!isHistoryVisit) {\n\t\tconst historyUrl = url + (this.scrollToElement || '');\n\t\tif (historyAction === 'replace') {\n\t\t\tupdateHistoryRecord(historyUrl);\n\t\t} else {\n\t\t\tcreateHistoryRecord(historyUrl);\n\t\t}\n\t}\n\n\tthis.currentPageUrl = getCurrentUrl();\n\n\t// when everything is ready, render the page\n\tPromise.all<PageRecord | void>([fetchPromise, ...animationPromises])\n\t\t.then(([pageData]) => {\n\t\t\tthis.renderPage(pageData as PageRecord, { event, skipTransition });\n\t\t})\n\t\t.catch((errorUrl) => {\n\t\t\t// Return early if errorUrl is not defined (probably aborted preload request)\n\t\t\tif (errorUrl === undefined) return;\n\n\t\t\t// Rewrite `skipPopStateHandling` to redirect manually when `history.go` is processed\n\t\t\tthis.options.skipPopStateHandling = () => {\n\t\t\t\twindow.location = errorUrl;\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t// Go back to the actual page we're still at\n\t\t\thistory.go(-1);\n\t\t});\n}\n","import { getCurrentUrl } from './getCurrentUrl.js';\n\nexport const createHistoryRecord = (\n\turl: string,\n\tcustomData: Record<string, unknown> = {}\n): void => {\n\turl = url || getCurrentUrl({ hash: true });\n\tconst data = {\n\t\turl,\n\t\trandom: Math.random(),\n\t\tsource: 'swup',\n\t\t...customData\n\t};\n\thistory.pushState(data, '', url);\n};\n","/**\n * Perform the replacement of content after loading a page.\n *\n * This method can be replaced or augmented by plugins to allow pausing.\n *\n * It takes an object with the page data as return from `getPageData` and has to\n * return a Promise that resolves once all content has been replaced and the\n * site is ready to start animating in the new page.\n *\n * @param {object} page The page object\n * @returns Promise\n */\nexport const replaceContent = function ({ blocks, title }: { blocks: string[]; title: string }) {\n\t// Replace content blocks\n\tblocks.forEach((html, i) => {\n\t\t// we know the block exists at this point\n\t\tconst block = document.body.querySelector(`[data-swup=\"${i}\"]`)!;\n\t\tblock.outerHTML = html;\n\t});\n\n\t// Update browser title\n\tdocument.title = title;\n\n\t// Return a Promise to allow plugins to defer\n\treturn Promise.resolve();\n};\n","import Swup from '../Swup.js';\nimport { DelegateEvent } from 'delegate-it';\n\ntype HandlersEventMap = {\n\tanimationInDone: undefined;\n\tanimationInStart: undefined;\n\tanimationOutDone: undefined;\n\tanimationOutStart: undefined;\n\tanimationSkipped: undefined;\n\tclickLink: DelegateEvent<MouseEvent>;\n\tcontentReplaced: PopStateEvent | undefined;\n\tdisabled: undefined;\n\tenabled: undefined;\n\topenPageInNewTab: DelegateEvent<MouseEvent>;\n\tpageLoaded: undefined;\n\tpageRetrievedFromCache: undefined;\n\tpageView: PopStateEvent | undefined;\n\tpopState: PopStateEvent;\n\tsamePage: DelegateEvent<MouseEvent>;\n\tsamePageWithHash: DelegateEvent<MouseEvent>;\n\tserverError: undefined;\n\ttransitionStart: PopStateEvent | undefined;\n\ttransitionEnd: PopStateEvent | undefined;\n\twillReplaceContent: PopStateEvent | undefined;\n};\ntype AvailableEventNames = keyof HandlersEventMap;\n\nexport type Handler<T extends keyof HandlersEventMap> = (event: HandlersEventMap[T]) => void;\nexport type Handlers = {\n\t[Key in keyof HandlersEventMap]: Handler<Key>[];\n};\n\nexport function on<TEventType extends AvailableEventNames>(\n\tthis: Swup,\n\tevent: TEventType,\n\thandler: Handler<TEventType>\n): void {\n\tconst eventHandlers = this._handlers[event] as Handler<TEventType>[];\n\n\tif (eventHandlers) {\n\t\teventHandlers.push(handler);\n\t} else {\n\t\tconsole.warn(`Unsupported event ${event}.`);\n\t}\n}\n\nexport function off<TEventType extends AvailableEventNames>(\n\tthis: Swup,\n\tevent?: TEventType,\n\thandler?: Handler<TEventType>\n) {\n\tif (event && handler) {\n\t\tconst eventHandlers = this._handlers[event] as Handler<TEventType>[];\n\t\t// Remove specific handler\n\t\tif (eventHandlers.includes(handler)) {\n\t\t\t(this._handlers[event] as Handler<TEventType>[]) = eventHandlers.filter(\n\t\t\t\t(h) => h !== handler\n\t\t\t);\n\t\t} else {\n\t\t\tconsole.warn(`Handler for event '${event}' not found.`);\n\t\t}\n\t} else if (event) {\n\t\t// Remove all handlers for specific event\n\t\tthis._handlers[event] = [];\n\t} else {\n\t\t// Remove all handlers for all events\n\t\tObject.keys(this._handlers).forEach((event) => {\n\t\t\tthis._handlers[event as keyof HandlersEventMap] = [];\n\t\t});\n\t}\n}\n\nexport function triggerEvent<TEventType extends AvailableEventNames>(\n\tthis: Swup,\n\teventName: TEventType,\n\toriginalEvent?: HandlersEventMap[TEventType]\n): void {\n\tconst eventHandlers = this._handlers[eventName] as Handler<TEventType>[];\n\n\t// call saved handlers with \"on\" method and pass originalEvent object if available\n\teventHandlers.forEach((handler) => {\n\t\ttry {\n\t\t\thandler(originalEvent as HandlersEventMap[TEventType]);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t}\n\t});\n\n\t// trigger event on document with prefix \"swup:\"\n\tconst event = new CustomEvent(`swup:${eventName}`, { detail: eventName });\n\tdocument.dispatchEvent(event);\n}\n","import Swup from '../Swup.js';\n\nexport type Plugin = {\n\tname: string;\n\tisSwupPlugin: true;\n\tmount: () => void;\n\tunmount: () => void;\n\n\t// the instance is assigned later on after passing to swup\n\tswup?: Swup;\n\n\t// these are possibly undefined for backward compatibility\n\tversion?: string;\n\trequires?: Record<string, string>;\n\t_beforeMount?: () => void;\n\t_afterUnmount?: () => void;\n\t_checkRequirements?: () => boolean;\n};\n\nconst isSwupPlugin = (maybeInvalidPlugin: unknown): maybeInvalidPlugin is Plugin => {\n\t// @ts-ignore\n\treturn maybeInvalidPlugin?.isSwupPlugin;\n};\n\nexport const use = function (this: Swup, plugin: unknown) {\n\tif (!isSwupPlugin(plugin)) {\n\t\tconsole.error('Not a swup plugin instance', plugin);\n\t\treturn;\n\t}\n\n\tplugin.swup = this;\n\tif (plugin._checkRequirements) {\n\t\tif (!plugin._checkRequirements()) {\n\t\t\treturn;\n\t\t}\n\t}\n\tif (plugin._beforeMount) {\n\t\tplugin._beforeMount();\n\t}\n\tplugin.mount();\n\n\tthis.plugins.push(plugin);\n\n\treturn this.plugins;\n};\n\nexport function unuse(this: Swup, pluginOrName: Plugin | string) {\n\tconst plugin = this.findPlugin(pluginOrName);\n\tif (!plugin) {\n\t\tconsole.error('No such plugin', plugin);\n\t\treturn;\n\t}\n\n\tplugin.unmount();\n\tif (plugin._afterUnmount) {\n\t\tplugin._afterUnmount();\n\t}\n\n\tthis.plugins = this.plugins.filter((p) => p !== plugin);\n\n\treturn this.plugins;\n}\n\nexport function findPlugin(this: Swup, pluginOrName: Plugin | string) {\n\treturn this.plugins.find((plugin) => plugin === pluginOrName || plugin.name === pluginOrName);\n}\n","import { Location, updateHistoryRecord, getCurrentUrl } from '../helpers.js';\nimport Swup from '../Swup.js';\nimport { PageRecord } from './Cache.js';\n\nexport type PageRenderOptions = {\n\tevent?: PopStateEvent;\n\tskipTransition?: boolean;\n};\n\nexport const renderPage = function (\n\tthis: Swup,\n\tpage: PageRecord,\n\t{ event, skipTransition }: PageRenderOptions = {}\n) {\n\tdocument.documentElement.classList.remove('is-leaving');\n\n\t// do nothing if another page was requested in the meantime\n\tif (!this.isSameResolvedUrl(getCurrentUrl(), page.url)) {\n\t\treturn;\n\t}\n\n\tconst { url } = Location.fromUrl(page.responseURL);\n\n\t// update cache and state if the url was redirected\n\tif (!this.isSameResolvedUrl(getCurrentUrl(), url)) {\n\t\tthis.cache.cacheUrl({ ...page, url });\n\t\tthis.currentPageUrl = getCurrentUrl();\n\t\tupdateHistoryRecord(url);\n\t}\n\n\t// only add for page loads with transitions\n\tif (!skipTransition) {\n\t\tdocument.documentElement.classList.add('is-rendering');\n\t}\n\n\tthis.triggerEvent('willReplaceContent', event);\n\n\tthis.replaceContent(page).then(() => {\n\t\tthis.triggerEvent('contentReplaced', event);\n\t\tthis.triggerEvent('pageView', event);\n\n\t\t// empty cache if it's disabled (in case preload plugin filled it)\n\t\tif (!this.options.cache) {\n\t\t\tthis.cache.empty();\n\t\t}\n\n\t\t// Perform in transition\n\t\tthis.enterPage({ event, skipTransition });\n\n\t\t// reset scroll-to element\n\t\tthis.scrollToElement = null;\n\t});\n};\n","import Swup from '../Swup.js';\n\nexport function updateTransition(this: Swup, from: string, to: string, custom?: string): void {\n\tthis.transition = { from, to, custom };\n}\n\nexport function shouldSkipTransition(this: Swup, { event }: { url?: string; event?: Event }) {\n\tconst isHistoryVisit = event instanceof PopStateEvent;\n\treturn !!(isHistoryVisit && !this.options.animateHistoryBrowsing);\n}\n","import { DelegateEvent } from 'delegate-it';\n\nimport version from './config/version.js';\n\nimport {\n\tcleanupAnimationClasses,\n\tdelegateEvent,\n\tgetCurrentUrl,\n\tLocation,\n\tmarkSwupElements,\n\tupdateHistoryRecord\n} from './helpers.js';\nimport { Unsubscribe } from './helpers/delegateEvent.js';\n\nimport { Cache } from './modules/Cache.js';\nimport { enterPage } from './modules/enterPage.js';\nimport { getAnchorElement } from './modules/getAnchorElement.js';\nimport { getAnimationPromises } from './modules/getAnimationPromises.js';\nimport { getPageData } from './modules/getPageData.js';\nimport { fetchPage } from './modules/fetchPage.js';\nimport { leavePage } from './modules/leavePage.js';\nimport { HistoryAction, loadPage, performPageLoad } from './modules/loadPage.js';\nimport { replaceContent } from './modules/replaceContent.js';\nimport { on, off, triggerEvent, Handlers } from './modules/events.js';\nimport { use, unuse, findPlugin, Plugin } from './modules/plugins.js';\nimport { renderPage } from './modules/renderPage.js';\nimport { updateTransition, shouldSkipTransition } from './modules/transitions.js';\n\nimport { queryAll } from './utils.js';\n\nexport type Transition = {\n\tfrom?: string;\n\tto?: string;\n\tcustom?: string;\n};\n\ntype DelegatedListeners = {\n\tclick?: Unsubscribe;\n};\n\nexport type Options = {\n\tanimateHistoryBrowsing: boolean;\n\tanimationSelector: string | false;\n\tlinkSelector: string;\n\tcache: boolean;\n\tcontainers: string[];\n\trequestHeaders: Record<string, string>;\n\tplugins: Plugin[];\n\tskipPopStateHandling: (event: any) => boolean;\n\tignoreVisit: (url: string, { el, event }: { el?: Element; event?: Event }) => boolean;\n\tresolveUrl: (url: string) => string;\n};\n\nexport default class Swup {\n\tversion = version;\n\n\t_handlers: Handlers = {\n\t\tanimationInDone: [],\n\t\tanimationInStart: [],\n\t\tanimationOutDone: [],\n\t\tanimationOutStart: [],\n\t\tanimationSkipped: [],\n\t\tclickLink: [],\n\t\tcontentReplaced: [],\n\t\tdisabled: [],\n\t\tenabled: [],\n\t\topenPageInNewTab: [],\n\t\tpageLoaded: [],\n\t\tpageRetrievedFromCache: [],\n\t\tpageView: [],\n\t\tpopState: [],\n\t\tsamePage: [],\n\t\tsamePageWithHash: [],\n\t\tserverError: [],\n\t\ttransitionStart: [],\n\t\ttransitionEnd: [],\n\t\twillReplaceContent: []\n\t};\n\n\t// variable for anchor to scroll to after render\n\tscrollToElement: string | null = null;\n\t// variable for save options\n\toptions: Options;\n\t// running plugin instances\n\tplugins: Plugin[] = [];\n\t// variable for current transition info object\n\ttransition: Transition = {};\n\t// cache instance\n\tcache: Cache;\n\t// allows us to compare the current and new path inside popStateHandler\n\tcurrentPageUrl = getCurrentUrl();\n\t// variable for keeping event listeners from \"delegate\"\n\tdelegatedListeners: DelegatedListeners = {};\n\t// so we are able to remove the listener\n\tboundPopStateHandler: (event: PopStateEvent) => void;\n\n\tloadPage = loadPage;\n\tperformPageLoad = performPageLoad;\n\tleavePage = leavePage;\n\trenderPage = renderPage;\n\treplaceContent = replaceContent;\n\tenterPage = enterPage;\n\ttriggerEvent = triggerEvent;\n\tdelegateEvent = delegateEvent;\n\ton = on;\n\toff = off;\n\tupdateTransition = updateTransition;\n\tshouldSkipTransition = shouldSkipTransition;\n\tgetAnimationPromises = getAnimationPromises;\n\tgetPageData = getPageData;\n\tfetchPage = fetchPage;\n\tgetAnchorElement = getAnchorElement;\n\tlog: (message: string, context?: any) => void = () => {}; // here so it can be used by plugins\n\tuse = use;\n\tunuse = unuse;\n\tfindPlugin = findPlugin;\n\tgetCurrentUrl = getCurrentUrl;\n\tcleanupAnimationClasses = cleanupAnimationClasses;\n\n\tdefaults: Options = {\n\t\tanimateHistoryBrowsing: false,\n\t\tanimationSelector: '[class*=\"transition-\"]',\n\t\tcache: true,\n\t\tcontainers: ['#swup'],\n\t\tignoreVisit: (url, { el, event } = {}) => !!el?.closest('[data-no-swup]'),\n\t\tlinkSelector: 'a[href]',\n\t\tplugins: [],\n\t\tresolveUrl: (url) => url,\n\t\trequestHeaders: {\n\t\t\t'X-Requested-With': 'swup',\n\t\t\tAccept: 'text/html, application/xhtml+xml'\n\t\t},\n\t\tskipPopStateHandling: (event) => event.state?.source !== 'swup'\n\t};\n\n\tconstructor(options: Partial<Options> = {}) {\n\t\t// Merge defaults and options\n\t\tthis.options = { ...this.defaults, ...options };\n\n\t\tthis.boundPopStateHandler = this.popStateHandler.bind(this);\n\n\t\tthis.cache = new Cache(this);\n\n\t\tthis.enable();\n\t}\n\n\tenable() {\n\t\t// Check for Promise support\n\t\tif (typeof Promise === 'undefined') {\n\t\t\tconsole.warn('Promise is not supported');\n\t\t\treturn;\n\t\t}\n\n\t\t// Add event listeners\n\t\tthis.delegatedListeners.click = delegateEvent(\n\t\t\tthis.options.linkSelector,\n\t\t\t'click',\n\t\t\tthis.linkClickHandler.bind(this)\n\t\t);\n\n\t\twindow.addEventListener('popstate', this.boundPopStateHandler);\n\n\t\t// Initial save to cache\n\t\tif (this.options.cache) {\n\t\t\t// Disabled to avoid caching modified dom state: logic moved to preload plugin\n\t\t\t// https://github.com/swup/swup/issues/475\n\t\t}\n\n\t\t// Mark swup blocks in html\n\t\tmarkSwupElements(document.documentElement, this.options.containers);\n\n\t\t// Mount plugins\n\t\tthis.options.plugins.forEach((plugin) => this.use(plugin));\n\n\t\t// Modify initial history record\n\t\tupdateHistoryRecord();\n\n\t\t// Trigger enabled event\n\t\tthis.triggerEvent('enabled');\n\n\t\t// Add swup-enabled class to html tag\n\t\tdocument.documentElement.classList.add('swup-enabled');\n\n\t\t// Trigger page view event\n\t\tthis.triggerEvent('pageView');\n\t}\n\n\tdestroy() {\n\t\t// remove delegated listeners\n\t\tthis.delegatedListeners.click!.destroy();\n\n\t\t// remove popstate listener\n\t\twindow.removeEventListener('popstate', this.boundPopStateHandler);\n\n\t\t// empty cache\n\t\tthis.cache.empty();\n\n\t\t// unmount plugins\n\t\tthis.options.plugins.forEach((plugin) => {\n\t\t\tthis.unuse(plugin);\n\t\t});\n\n\t\t// remove swup data atributes from blocks\n\t\tqueryAll('[data-swup]').forEach((element) => {\n\t\t\telement.removeAttribute('data-swup');\n\t\t});\n\n\t\t// remove handlers\n\t\tthis.off();\n\n\t\t// trigger disable event\n\t\tthis.triggerEvent('disabled');\n\n\t\t// remove swup-enabled class from html tag\n\t\tdocument.documentElement.classList.remove('swup-enabled');\n\t}\n\n\tshouldIgnoreVisit(href: string, { el, event }: { el?: Element; event?: Event } = {}) {\n\t\tconst { origin, url, hash } = Location.fromUrl(href);\n\n\t\t// Ignore if the new origin doesn't match the current one\n\t\tif (origin !== window.location.origin) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Ignore if the link/form would open a new window (or none at all)\n\t\tif (el && this.triggerWillOpenNewWindow(el)) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Ignore if the visit should be ignored as per user options\n\t\tif (this.options.ignoreVisit(url + hash, { el, event })) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Finally, allow the visit\n\t\treturn false;\n\t}\n\n\tlinkClickHandler(event: DelegateEvent<MouseEvent>) {\n\t\tconst linkEl = event.delegateTarget;\n\t\tconst { href, url, hash } = Location.fromElement(linkEl as HTMLAnchorElement);\n\n\t\t// Exit early if the link should be ignored\n\t\tif (this.shouldIgnoreVisit(href, { el: linkEl, event })) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Exit early if control key pressed\n\t\tif (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\n\t\t\tthis.triggerEvent('openPageInNewTab', event);\n\t\t\treturn;\n\t\t}\n\n\t\t// Exit early if other than left mouse button\n\t\tif (event.button !== 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.triggerEvent('clickLink', event);\n\t\tevent.preventDefault();\n\n\t\t// Handle links to the same page and exit early, where applicable\n\t\tif (!url || url === getCurrentUrl()) {\n\t\t\tthis.handleLinkToSamePage(url, hash, event);\n\t\t\treturn;\n\t\t}\n\n\t\t// Exit early if the resolved path hasn't changed\n\t\tif (this.isSameResolvedUrl(url, getCurrentUrl())) return;\n\n\t\t// Store the element that should be scrolled to after loading the next page\n\t\tthis.scrollToElement = hash || null;\n\n\t\t// Get the custom transition name, if present\n\t\tconst customTransition = linkEl.getAttribute('data-swup-transition') || undefined;\n\n\t\t// Get the history action, if set\n\t\tlet history: HistoryAction | undefined;\n\t\tconst historyAttr = linkEl.getAttribute('data-swup-history');\n\t\tif (historyAttr && ['push', 'replace'].includes(historyAttr)) {\n\t\t\thistory = historyAttr as HistoryAction;\n\t\t}\n\n\t\t// Finally, proceed with loading the page\n\t\tthis.performPageLoad({ url, customTransition, history });\n\t}\n\n\thandleLinkToSamePage(url: string, hash: string, event: DelegateEvent<MouseEvent>) {\n\t\t// Emit event and exit early if the url points to the same page without hash\n\t\tif (!hash) {\n\t\t\tthis.triggerEvent('samePage', event);\n\t\t\treturn;\n\t\t}\n\n\t\t// link to the same URL with hash\n\t\tthis.triggerEvent('samePageWithHash', event);\n\n\t\tconst element = getAnchorElement(hash);\n\n\t\t// Warn and exit early if no matching element was found for the hash\n\t\tif (!element) {\n\t\t\treturn console.warn(`Element for offset not found (#${hash})`);\n\t\t}\n\n\t\tupdateHistoryRecord(url + hash);\n\t}\n\n\ttriggerWillOpenNewWindow(triggerEl: Element) {\n\t\tif (triggerEl.matches('[download], [target=\"_blank\"]')) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpopStateHandler(event: PopStateEvent) {\n\t\t// Exit early if this event should be ignored\n\t\tif (this.options.skipPopStateHandling(event)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Exit early if the resolved path hasn't changed\n\t\tif (this.isSameResolvedUrl(getCurrentUrl(), this.currentPageUrl)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst href = event.state?.url ?? location.href;\n\n\t\t// Exit early if the link should be ignored\n\t\tif (this.shouldIgnoreVisit(href, { event })) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { url, hash } = Location.fromUrl(href);\n\n\t\tif (hash) {\n\t\t\tthis.scrollToElement = hash;\n\t\t} else {\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tthis.triggerEvent('popState', event);\n\n\t\tif (!this.options.animateHistoryBrowsing) {\n\t\t\tdocument.documentElement.classList.remove('is-animating');\n\t\t\tcleanupAnimationClasses();\n\t\t}\n\n\t\tthis.performPageLoad({ url, event });\n\t}\n\n\t/**\n\t * Utility function to validate and run the global option 'resolveUrl'\n\t * @param {string} url\n\t * @returns {string} the resolved url\n\t */\n\tresolveUrl(url: string) {\n\t\tif (typeof this.options.resolveUrl !== 'function') {\n\t\t\tconsole.warn(`[swup] options.resolveUrl expects a callback function.`);\n\t\t\treturn url;\n\t\t}\n\t\tconst result = this.options.resolveUrl(url);\n\t\tif (!result || typeof result !== 'string') {\n\t\t\tconsole.warn(`[swup] options.resolveUrl needs to return a url`);\n\t\t\treturn url;\n\t\t}\n\t\tif (result.startsWith('//') || result.startsWith('http')) {\n\t\t\tconsole.warn(`[swup] options.resolveUrl needs to return a relative url`);\n\t\t\treturn url;\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Compares the resolved version of two paths and returns true if they are the same\n\t * @param {string} url1\n\t * @param {string} url2\n\t * @returns {boolean}\n\t */\n\tisSameResolvedUrl(url1: string, url2: string) {\n\t\treturn this.resolveUrl(url1) === this.resolveUrl(url2);\n\t}\n}\n"],"names":["getCurrentUrl","_temp","hash","location","pathname","search","updateHistoryRecord","url","customData","data","history","state","random","Math","source","replaceState","ledger","WeakMap","editLedger","wanted","baseElement","callback","setup","has","elementMap","get","set","setups","Set","existed","add","delete","delegateEvent","selector","type","options","signal","base","document","aborted","once","nativeListenerOptions","Document","documentElement","capture","Boolean","listenerFn","event","delegateTarget","target","Text","parentElement","Element","currentTarget","closest","contains","safeClosest","Object","assign","call","removeEventListener","JSON","stringify","addEventListener","delegate","destroy","controller","abort","query","context","querySelector","queryAll","Array","from","querySelectorAll","escapeCssIdentifier","ident","window","CSS","escape","toMs","s","Number","slice","replace","Location","constructor","baseURI","super","toString","this","static","el","getAttribute","href","markSwupElements","isSwupClass","className","test","includes","cleanupAnimationClasses","removeClasses","split","filter","classList","remove","Cache","swup","pages","last","getCacheUrl","resolveUrl","fromUrl","cacheUrl","page","responseURL","log","keys","length","getPage","getCurrentPage","exists","empty","enterPage","skipTransition","triggerEvent","Promise","resolve","requestAnimationFrame","animationPromises","getAnimationPromises","all","then","getAnchorElement","charAt","substring","decodeURIComponent","element","getElementById","decoded","body","transitionProp","transitionEndEvent","animationProp","animationEndEvent","animationType","animationSelector","animatedElements","console","warn","map","timeout","propCount","expectedType","getComputedStyle","transitionDuration","animationDelay","animationDuration","transitionDelays","styles","transitionTimeout","calculateTimeout","transitionDurations","animationDelays","animationDurations","animationTimeout","max","getTransitionInfo","endEvent","startTime","performance","now","propsTransitioned","end","onEnd","isTransitionOrAnimationEvent","elapsedTime","setTimeout","getAnimationPromiseForElement","delays","durations","concat","duration","i","undefined","ontransitionend","onwebkittransitionend","onanimationend","onwebkitanimationend","getPageData","request","pageHtmlData","html","containers","fakeDom","createElement","innerHTML","blocks","forEach","item","index","setAttribute","String","push","outerHTML","title","innerText","pageClass","originalContent","getDataFromHtml","responseText","fetchPage","headers","requestHeaders","cache","reject","defaults","method","onreadystatechange","readyState","open","entries","_ref","key","header","setRequestHeader","send","fetch","response","status","cacheablePageData","leavePage","isHistoryVisit","shouldIgnoreVisit","performPageLoad","customTransition","historyAction","shouldSkipTransition","text","updateTransition","toLowerCase","fetchPromise","scrollToElement","historyUrl","pushState","createHistoryRecord","currentPageUrl","pageData","renderPage","catch","errorUrl","skipPopStateHandling","go","replaceContent","handler","eventHandlers","_handlers","off","h","eventName","originalEvent","error","CustomEvent","detail","dispatchEvent","plugin","isSwupPlugin","_checkRequirements","_beforeMount","mount","plugins","pluginOrName","findPlugin","unmount","_afterUnmount","p","find","name","isSameResolvedUrl","to","custom","transition","PopStateEvent","animateHistoryBrowsing","Swup","version","animationInDone","animationInStart","animationOutDone","animationOutStart","animationSkipped","clickLink","contentReplaced","disabled","enabled","openPageInNewTab","pageLoaded","pageRetrievedFromCache","pageView","popState","samePage","samePageWithHash","serverError","transitionStart","transitionEnd","willReplaceContent","delegatedListeners","boundPopStateHandler","loadPage","on","use","unuse","ignoreVisit","linkSelector","Accept","popStateHandler","bind","enable","click","linkClickHandler","removeAttribute","_temp2","origin","triggerWillOpenNewWindow","linkEl","fromElement","metaKey","ctrlKey","shiftKey","altKey","button","preventDefault","handleLinkToSamePage","historyAttr","triggerEl","matches","result","startsWith","url1","url2"],"mappings":"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"}