{"version":3,"file":"Swup.umd.js","sources":["../src/helpers/classify.ts","../src/helpers/getCurrentUrl.ts","../src/helpers/createHistoryRecord.ts","../src/helpers/updateHistoryRecord.ts","../node_modules/delegate-it/delegate.js","../src/helpers/delegateEvent.ts","../src/helpers/Location.ts","../src/modules/Cache.ts","../src/utils/index.ts","../src/modules/Classes.ts","../src/modules/Visit.ts","../src/modules/Hooks.ts","../src/modules/getAnchorElement.ts","../src/modules/awaitAnimations.ts","../src/modules/navigate.ts","../src/modules/fetchPage.ts","../src/modules/animatePageOut.ts","../src/modules/replaceContent.ts","../src/modules/scrollToContent.ts","../src/modules/animatePageIn.ts","../src/modules/renderPage.ts","../src/modules/plugins.ts","../src/modules/resolveUrl.ts","../src/Swup.ts"],"sourcesContent":["/** Turn a string into a slug by lowercasing and replacing whitespace. */\nexport const classify = (text: string, fallback?: string): string => {\n\tconst output = String(text)\n\t\t.toLowerCase()\n\t\t// .normalize('NFD') // split an accented letter in the base letter and the acent\n\t\t// .replace(/[\\u0300-\\u036f]/g, '') // remove all previously split accents\n\t\t.replace(/[\\s/_.]+/g, '-') // replace spaces and _./ with '-'\n\t\t.replace(/[^\\w-]+/g, '') // remove all non-word chars\n\t\t.replace(/--+/g, '-') // replace repeating '-' with single '-'\n\t\t.replace(/^-+|-+$/g, ''); // trim '-' from edges\n\treturn output || fallback || '';\n};\n","/** Get the current page URL: path name + query params. Optionally including hash. */\nexport const getCurrentUrl = ({ hash }: { hash?: boolean } = {}): string => {\n\treturn location.pathname + location.search + (hash ? location.hash : '');\n};\n","import { getCurrentUrl } from './getCurrentUrl.js';\n\n/** Create a new history record with a custom swup identifier. */\nexport const createHistoryRecord = (\n\turl: string,\n\tcustomData: Record<string, unknown> = {}\n): void => {\n\turl = url || getCurrentUrl({ hash: true });\n\tconst data = {\n\t\turl,\n\t\trandom: Math.random(),\n\t\tsource: 'swup',\n\t\t...customData\n\t};\n\thistory.pushState(data, '', url);\n};\n","import { getCurrentUrl } from './getCurrentUrl.js';\n\n/** Update the current history record with a custom swup identifier. */\nexport const updateHistoryRecord = (\n\turl: string | null = null,\n\tcustomData: Record<string, unknown> = {}\n): void => {\n\turl = url || getCurrentUrl({ hash: true });\n\tconst data = {\n\t\t...history.state,\n\t\turl,\n\t\trandom: Math.random(),\n\t\tsource: 'swup',\n\t\t...customData\n\t};\n\thistory.replaceState(data, '', url);\n};\n","/** Keeps track of raw listeners added to the base elements to avoid duplication */\nconst ledger = new WeakMap();\nfunction editLedger(wanted, baseElement, callback, setup) {\n    if (!wanted && !ledger.has(baseElement)) {\n        return false;\n    }\n    const elementMap = ledger.get(baseElement)\n        ?? new WeakMap();\n    ledger.set(baseElement, elementMap);\n    const setups = elementMap.get(callback) ?? new Set();\n    elementMap.set(callback, setups);\n    const existed = setups.has(setup);\n    if (wanted) {\n        setups.add(setup);\n    }\n    else {\n        setups.delete(setup);\n    }\n    return existed && wanted;\n}\nfunction safeClosest(event, selector) {\n    let target = event.target;\n    if (target instanceof Text) {\n        target = target.parentElement;\n    }\n    if (target instanceof Element && event.currentTarget instanceof Element) {\n        // `.closest()` may match ancestors of `currentTarget` but we only need its children\n        const closest = target.closest(selector);\n        if (closest && event.currentTarget.contains(closest)) {\n            return closest;\n        }\n    }\n}\n// This type isn't exported as a declaration, so it needs to be duplicated above\nfunction delegate(selector, type, callback, options = {}) {\n    const { signal, base = document } = options;\n    if (signal?.aborted) {\n        return;\n    }\n    // Don't pass `once` to `addEventListener` because it needs to be handled in `delegate-it`\n    const { once, ...nativeListenerOptions } = options;\n    // `document` should never be the base, it's just an easy way to define \"global event listeners\"\n    const baseElement = base instanceof Document ? base.documentElement : base;\n    // Handle the regular Element usage\n    const capture = Boolean(typeof options === 'object' ? options.capture : options);\n    const listenerFn = (event) => {\n        const delegateTarget = safeClosest(event, selector);\n        if (delegateTarget) {\n            const delegateEvent = Object.assign(event, { delegateTarget });\n            callback.call(baseElement, delegateEvent);\n            if (once) {\n                baseElement.removeEventListener(type, listenerFn, nativeListenerOptions);\n                editLedger(false, baseElement, callback, setup);\n            }\n        }\n    };\n    const setup = JSON.stringify({ selector, type, capture });\n    const isAlreadyListening = editLedger(true, baseElement, callback, setup);\n    if (!isAlreadyListening) {\n        baseElement.addEventListener(type, listenerFn, nativeListenerOptions);\n    }\n    signal?.addEventListener('abort', () => {\n        editLedger(false, baseElement, callback, setup);\n    });\n}\nexport default delegate;\n","import delegate, { DelegateEventHandler, DelegateOptions, EventType } from 'delegate-it';\nimport { ParseSelector } from 'typed-query-selector/parser.js';\n\nexport type DelegateEventUnsubscribe = {\n\tdestroy: () => void;\n};\n\n/** Register a delegated event listener. */\nexport const delegateEvent = <\n\tSelector extends string,\n\tTElement extends Element = ParseSelector<Selector, HTMLElement>,\n\tTEvent extends EventType = EventType\n>(\n\tselector: Selector,\n\ttype: TEvent,\n\tcallback: DelegateEventHandler<GlobalEventHandlersEventMap[TEvent], TElement>,\n\toptions?: DelegateOptions\n): DelegateEventUnsubscribe => {\n\tconst controller = new AbortController();\n\toptions = { ...options, signal: controller.signal };\n\tdelegate<Selector, TElement, TEvent>(selector, type, callback, options);\n\treturn { destroy: () => controller.abort() };\n};\n","/**\n * A helper for creating a Location from either an element\n * or a URL object/string\n *\n */\nexport class Location extends URL {\n\tconstructor(url: URL | string, base: string = document.baseURI) {\n\t\tsuper(url.toString(), base);\n\t}\n\n\t/**\n\t * The full local path including query params.\n\t */\n\tget url(): string {\n\t\treturn this.pathname + this.search;\n\t}\n\n\t/**\n\t * Instantiate a Location from an element's href attribute\n\t * @param el\n\t * @returns new Location instance\n\t */\n\tstatic fromElement(el: Element): Location {\n\t\tconst href = el.getAttribute('href') || el.getAttribute('xlink:href') || '';\n\t\treturn new Location(href);\n\t}\n\n\t/**\n\t * Instantiate a Location from a URL object or string\n\t * @param url\n\t * @returns new Location instance\n\t */\n\tstatic fromUrl(url: URL | string): Location {\n\t\treturn new Location(url);\n\t}\n}\n","import Swup from '../Swup.js';\nimport { Location } from '../helpers.js';\nimport { PageData } from './fetchPage.js';\n\nexport interface CacheData extends PageData {}\n\n/**\n * In-memory page cache.\n */\nexport class Cache {\n\t/** Swup instance this cache belongs to */\n\tprotected swup: Swup;\n\n\t/** Cached pages, indexed by URL */\n\tprotected pages: Map<string, CacheData> = new Map();\n\n\tconstructor(swup: Swup) {\n\t\tthis.swup = swup;\n\t}\n\n\t/** Number of cached pages in memory. */\n\tget size(): number {\n\t\treturn this.pages.size;\n\t}\n\n\t/** All cached pages. */\n\tget all() {\n\t\tconst copy = new Map();\n\t\tthis.pages.forEach((page, key) => {\n\t\t\tcopy.set(key, { ...page });\n\t\t});\n\t\treturn copy;\n\t}\n\n\t/** Check if the given URL has been cached. */\n\thas(url: string): boolean {\n\t\treturn this.pages.has(this.resolve(url));\n\t}\n\n\t/** Return a shallow copy of the cached page object if available. */\n\tget(url: string): CacheData | undefined {\n\t\tconst result = this.pages.get(this.resolve(url));\n\t\tif (!result) return result;\n\t\treturn { ...result };\n\t}\n\n\t/** Create a cache record for the specified URL. */\n\tset(url: string, page: CacheData) {\n\t\turl = this.resolve(url);\n\t\tpage = { ...page, url };\n\t\tthis.pages.set(url, page);\n\t\tthis.swup.hooks.callSync('cache:set', { page });\n\t}\n\n\t/** Update a cache record, overwriting or adding custom data. */\n\tupdate(url: string, payload: Record<string, any>) {\n\t\turl = this.resolve(url);\n\t\tconst page = { ...this.get(url), ...payload, url } as CacheData;\n\t\tthis.pages.set(url, page);\n\t}\n\n\t/** Delete a cache record. */\n\tdelete(url: string): void {\n\t\tthis.pages.delete(this.resolve(url));\n\t}\n\n\t/** Empty the cache. */\n\tclear(): void {\n\t\tthis.pages.clear();\n\t\tthis.swup.hooks.callSync('cache:clear');\n\t}\n\n\t/** Remove all cache entries that return true for a given predicate function.  */\n\tprune(predicate: (url: string, page: CacheData) => boolean): void {\n\t\tthis.pages.forEach((page, url) => {\n\t\t\tif (predicate(url, page)) {\n\t\t\t\tthis.delete(url);\n\t\t\t}\n\t\t});\n\t}\n\n\t/** Resolve URLs by making them local and letting swup resolve them. */\n\tprotected resolve(urlToResolve: string): string {\n\t\tconst { url } = Location.fromUrl(urlToResolve);\n\t\treturn this.swup.resolveUrl(url);\n\t}\n}\n","/** Find an element by selector. */\nexport const query = (selector: string, context: Document | Element = document) => {\n\treturn context.querySelector<HTMLElement>(selector);\n};\n\n/** Find a set of elements by selector. */\nexport const queryAll = (\n\tselector: string,\n\tcontext: Document | Element = document\n): HTMLElement[] => {\n\treturn Array.from(context.querySelectorAll(selector));\n};\n\n/** Return a Promise that resolves after the next event loop. */\nexport const nextTick = (): Promise<void> => {\n\treturn new Promise((resolve) => {\n\t\trequestAnimationFrame(() => {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t});\n};\n\n/** Check if an object is a Promise or a Thenable */\nexport function isPromise<T>(obj: any): obj is PromiseLike<T> {\n\treturn (\n\t\t!!obj &&\n\t\t(typeof obj === 'object' || typeof obj === 'function') &&\n\t\ttypeof obj.then === 'function'\n\t);\n}\n\n/** Call a function as a Promise. Resolves with the returned Promsise or immediately. */\nexport function runAsPromise(func: Function, args: any[] = []): Promise<any> {\n\treturn new Promise((resolve, reject) => {\n\t\tconst result = func(...args);\n\t\tif (isPromise(result)) {\n\t\t\tresult.then(resolve, reject);\n\t\t} else {\n\t\t\tresolve(result);\n\t\t}\n\t});\n}\n\n/**\n * Force a layout reflow, e.g. after adding classnames\n * @returns The offset height, just here so it doesn't get optimized away by the JS engine\n * @see https://stackoverflow.com/a/21665117/3759615\n */\nexport function forceReflow(element?: HTMLElement) {\n\telement = element || document.body;\n\treturn element?.offsetHeight;\n}\n\n/** Escape a string with special chars to not break CSS selectors. */\nexport const escapeCssIdentifier = (ident: string) => {\n\t// @ts-ignore this is for support check, so it's correct that TS complains\n\tif (window.CSS && window.CSS.escape) {\n\t\treturn CSS.escape(ident);\n\t}\n\treturn ident;\n};\n\n/** Fix for Chrome below v61 formatting CSS floats with comma in some locales. */\nexport const toMs = (s: string) => {\n\treturn Number(s.slice(0, -1).replace(',', '.')) * 1000;\n};\n","import Swup from '../Swup.js';\nimport { queryAll } from '../utils.js';\n\nexport class Classes {\n\tprotected swup: Swup;\n\tprotected swupClasses = ['to-', 'is-changing', 'is-rendering', 'is-popstate', 'is-animating'];\n\n\tconstructor(swup: Swup) {\n\t\tthis.swup = swup;\n\t}\n\n\tprotected get selectors(): string[] {\n\t\tconst { scope } = this.swup.visit.animation;\n\t\tif (scope === 'containers') return this.swup.visit.containers;\n\t\tif (scope === 'html') return ['html'];\n\t\tif (Array.isArray(scope)) return scope;\n\t\treturn [];\n\t}\n\n\tprotected get selector(): string {\n\t\treturn this.selectors.join(',');\n\t}\n\n\tprotected get targets(): HTMLElement[] {\n\t\tif (!this.selector.trim()) return [];\n\t\treturn queryAll(this.selector) as HTMLElement[];\n\t}\n\n\tadd(...classes: string[]): void {\n\t\tthis.targets.forEach((target) => target.classList.add(...classes));\n\t}\n\n\tremove(...classes: string[]): void {\n\t\tthis.targets.forEach((target) => target.classList.remove(...classes));\n\t}\n\n\tclear(): void {\n\t\tthis.targets.forEach((target) => {\n\t\t\tconst remove = target.className.split(' ').filter((c) => this.isSwupClass(c));\n\t\t\ttarget.classList.remove(...remove);\n\t\t});\n\t}\n\n\tprotected isSwupClass(className: string): boolean {\n\t\treturn this.swupClasses.some((c) => className.startsWith(c));\n\t}\n}\n","import Swup, { Options } from '../Swup.js';\nimport { HistoryAction, HistoryDirection } from './navigate.js';\n\n/** An object holding details about the current visit. */\nexport interface Visit {\n\t/** The previous page, about to leave */\n\tfrom: VisitFrom;\n\t/** The next page, about to enter */\n\tto: VisitTo;\n\t/** The content containers, about to be replaced */\n\tcontainers: Options['containers'];\n\t/** Information about animated page transitions */\n\tanimation: VisitAnimation;\n\t/** What triggered this visit */\n\ttrigger: VisitTrigger;\n\t/** Browser history behavior on this visit */\n\thistory: VisitHistory;\n\t/** Scroll behavior on this visit */\n\tscroll: VisitScroll;\n}\n\nexport interface VisitFrom {\n\t/** The URL of the previous page */\n\turl: string;\n}\n\nexport interface VisitTo {\n\t/** The URL of the next page */\n\turl?: string;\n\t/** The HTML content of the next page */\n\thtml?: string;\n}\n\nexport interface VisitAnimation {\n\t/** Whether this visit is animated. Default: `true` */\n\tanimate: boolean;\n\t/** Whether to wait for the next page to load before starting the animation. Default: `false` */\n\twait: boolean;\n\t/** Name of a custom animation to run. */\n\tname?: string;\n\t/** Elements on which to add animation classes. Default: `html` element */\n\tscope: 'html' | 'containers' | string[];\n\t/** Selector for detecting animation timing. Default: `[class*=\"transition-\"]` */\n\tselector: Options['animationSelector'];\n}\n\nexport interface VisitScroll {\n\t/** Whether to reset the scroll position after the visit. Default: `true` */\n\treset: boolean;\n\t/** Anchor element to scroll to on the next page. */\n\ttarget?: string;\n}\n\nexport interface VisitTrigger {\n\t/** DOM element that triggered this visit. */\n\tel?: Element;\n\t/** DOM event that triggered this visit. */\n\tevent?: Event;\n}\n\nexport interface VisitHistory {\n\t/** History action to perform: `push` for creating a new history entry, `replace` for replacing the current entry. Default: `push` */\n\taction: HistoryAction;\n\t/** Whether this visit was triggered by a browser history navigation. */\n\tpopstate: boolean;\n\t/** The direction of travel in case of a browser history navigation: backward or forward. */\n\tdirection: HistoryDirection | undefined;\n}\n\nexport interface VisitInitOptions {\n\tto: string | undefined;\n\tfrom?: string;\n\thash?: string;\n\tanimate?: boolean;\n\tanimation?: string;\n\ttargets?: string[];\n\tel?: Element;\n\tevent?: Event;\n\taction?: HistoryAction;\n\tresetScroll?: boolean;\n}\n\n/** Create a new visit object. */\nexport function createVisit(\n\tthis: Swup,\n\t{\n\t\tto,\n\t\tfrom = this.currentPageUrl,\n\t\thash: target,\n\t\tanimate = true,\n\t\tanimation: name,\n\t\tel,\n\t\tevent,\n\t\taction = 'push',\n\t\tresetScroll: reset = true\n\t}: VisitInitOptions\n): Visit {\n\treturn {\n\t\tfrom: { url: from },\n\t\tto: { url: to },\n\t\tcontainers: this.options.containers,\n\t\tanimation: {\n\t\t\tanimate,\n\t\t\twait: false,\n\t\t\tname,\n\t\t\tscope: this.options.animationScope,\n\t\t\tselector: this.options.animationSelector\n\t\t},\n\t\ttrigger: {\n\t\t\tel,\n\t\t\tevent\n\t\t},\n\t\thistory: {\n\t\t\taction,\n\t\t\tpopstate: false,\n\t\t\tdirection: undefined\n\t\t},\n\t\tscroll: {\n\t\t\treset,\n\t\t\ttarget\n\t\t}\n\t};\n}\n","import { DelegateEvent } from 'delegate-it';\n\nimport Swup from '../Swup.js';\nimport { isPromise, runAsPromise } from '../utils.js';\nimport { Visit } from './Visit.js';\nimport { FetchOptions, PageData } from './fetchPage.js';\n\nexport interface HookDefinitions {\n\t'animation:out:start': undefined;\n\t'animation:out:await': { skip: boolean };\n\t'animation:out:end': undefined;\n\t'animation:in:start': undefined;\n\t'animation:in:await': { skip: boolean };\n\t'animation:in:end': undefined;\n\t'animation:skip': undefined;\n\t'cache:clear': undefined;\n\t'cache:set': { page: PageData };\n\t'content:replace': { page: PageData };\n\t'content:scroll': undefined;\n\t'enable': undefined;\n\t'disable': undefined;\n\t'fetch:request': { url: string; options: FetchOptions };\n\t'fetch:error': { url: string; status: number; response: Response };\n\t'history:popstate': { event: PopStateEvent };\n\t'link:click': { el: HTMLAnchorElement; event: DelegateEvent<MouseEvent> };\n\t'link:self': undefined;\n\t'link:anchor': { hash: string };\n\t'link:newtab': { href: string };\n\t'page:load': { page?: PageData; cache?: boolean; options: FetchOptions };\n\t'page:view': { url: string; title: string };\n\t'scroll:top': { options: ScrollIntoViewOptions };\n\t'scroll:anchor': { hash: string; options: ScrollIntoViewOptions };\n\t'visit:start': undefined;\n\t'visit:end': undefined;\n}\n\nexport type HookArguments<T extends HookName> = HookDefinitions[T];\n\nexport type HookName = keyof HookDefinitions;\n\n/** A hook handler. */\nexport type Handler<T extends HookName> = (\n\t/** Context about the current visit. */\n\tvisit: Visit,\n\t/** Local arguments passed into the handler. */\n\targs: HookArguments<T>,\n\t/** Default handler to be executed. Available if replacing an internal hook handler. */\n\tdefaultHandler?: Handler<T>\n) => Promise<any> | any;\n\nexport type Handlers = {\n\t[K in HookName]: Handler<K>[];\n};\n\n/** Unregister a previously registered hook handler. */\nexport type HookUnregister = () => void;\n\n/** Define when and how a hook handler is executed. */\nexport type HookOptions = {\n\t/** Execute the hook once, then remove the handler */\n\tonce?: boolean;\n\t/** Execute the hook before the internal default handler */\n\tbefore?: boolean;\n\t/** Set a priority for when to execute this hook. Lower numbers execute first. Default: `0` */\n\tpriority?: number;\n\t/** Replace the internal default handler with this hook handler */\n\treplace?: boolean;\n};\n\nexport type HookRegistration<T extends HookName> = {\n\tid: number;\n\thook: T;\n\thandler: Handler<T>;\n\tdefaultHandler?: Handler<T>;\n} & HookOptions;\n\ntype HookLedger<T extends HookName> = Map<Handler<T>, HookRegistration<T>>;\n\ninterface HookRegistry extends Map<HookName, HookLedger<HookName>> {\n\tget<K extends HookName>(key: K): HookLedger<K> | undefined;\n\tset<K extends HookName>(key: K, value: HookLedger<K>): this;\n}\n\n/**\n * Hook registry.\n *\n * Create, trigger and handle hooks.\n *\n */\nexport class Hooks {\n\t/** Swup instance this registry belongs to */\n\tprotected swup: Swup;\n\n\t/** Map of all registered hook handlers. */\n\tprotected registry: HookRegistry = new Map();\n\n\t// Can we deduplicate this somehow? Or make it error when not in sync with HookDefinitions?\n\t// https://stackoverflow.com/questions/53387838/how-to-ensure-an-arrays-values-the-keys-of-a-typescript-interface/53395649\n\tprotected readonly hooks: HookName[] = [\n\t\t'animation:out:start',\n\t\t'animation:out:await',\n\t\t'animation:out:end',\n\t\t'animation:in:start',\n\t\t'animation:in:await',\n\t\t'animation:in:end',\n\t\t'animation:skip',\n\t\t'cache:clear',\n\t\t'cache:set',\n\t\t'content:replace',\n\t\t'content:scroll',\n\t\t'enable',\n\t\t'disable',\n\t\t'fetch:request',\n\t\t'fetch:error',\n\t\t'history:popstate',\n\t\t'link:click',\n\t\t'link:self',\n\t\t'link:anchor',\n\t\t'link:newtab',\n\t\t'page:load',\n\t\t'page:view',\n\t\t'scroll:top',\n\t\t'scroll:anchor',\n\t\t'visit:start',\n\t\t'visit:end'\n\t];\n\n\tconstructor(swup: Swup) {\n\t\tthis.swup = swup;\n\t\tthis.init();\n\t}\n\n\t/**\n\t * Create ledgers for all core hooks.\n\t */\n\tprotected init() {\n\t\tthis.hooks.forEach((hook) => this.create(hook));\n\t}\n\n\t/**\n\t * Create a new hook type.\n\t */\n\tcreate(hook: string) {\n\t\tif (!this.registry.has(hook as HookName)) {\n\t\t\tthis.registry.set(hook as HookName, new Map());\n\t\t}\n\t}\n\n\t/**\n\t * Check if a hook type exists.\n\t */\n\texists(hook: HookName): boolean {\n\t\treturn this.registry.has(hook);\n\t}\n\n\t/**\n\t * Get the ledger with all registrations for a hook.\n\t */\n\tprotected get<T extends HookName>(hook: T): HookLedger<T> | undefined {\n\t\tconst ledger = this.registry.get(hook);\n\t\tif (ledger) {\n\t\t\treturn ledger;\n\t\t}\n\t\tconsole.error(`Unknown hook '${hook}'`);\n\t}\n\n\t/**\n\t * Remove all handlers of all hooks.\n\t */\n\tclear() {\n\t\tthis.registry.forEach((ledger) => ledger.clear());\n\t}\n\n\t/**\n\t * Register a new hook handler.\n\t * @param hook Name of the hook to listen for\n\t * @param handler The handler function to execute\n\t * @param options Object to specify how and when the handler is executed\n\t *                Available options:\n\t *                - `once`: Only execute the handler once\n\t *                - `before`: Execute the handler before the default handler\n\t *                - `priority`: Specify the order in which the handlers are executed\n\t *                - `replace`: Replace the default handler with this handler\n\t * @returns A function to unregister the handler\n\t */\n\ton<T extends HookName>(hook: T, handler: Handler<T>): HookUnregister;\n\ton<T extends HookName>(hook: T, handler: Handler<T>, options: HookOptions): HookUnregister;\n\ton<T extends HookName>(\n\t\thook: T,\n\t\thandler: Handler<T>,\n\t\toptions: HookOptions = {}\n\t): HookUnregister {\n\t\tconst ledger = this.get(hook);\n\t\tif (!ledger) {\n\t\t\tconsole.warn(`Hook '${hook}' not found.`);\n\t\t\treturn () => {};\n\t\t}\n\n\t\tconst id = ledger.size + 1;\n\t\tconst registration: HookRegistration<T> = { ...options, id, hook, handler };\n\t\tledger.set(handler, registration);\n\n\t\treturn () => this.off(hook, handler);\n\t}\n\n\t/**\n\t * Register a new hook handler to run before the default handler.\n\t * Shortcut for `hooks.on(hook, handler, { before: true })`.\n\t * @param hook Name of the hook to listen for\n\t * @param handler The handler function to execute\n\t * @param options Any other event options (see `hooks.on()` for details)\n\t * @returns A function to unregister the handler\n\t * @see on\n\t */\n\tbefore<T extends HookName>(hook: T, handler: Handler<T>): HookUnregister;\n\tbefore<T extends HookName>(hook: T, handler: Handler<T>, options: HookOptions): HookUnregister;\n\tbefore<T extends HookName>(\n\t\thook: T,\n\t\thandler: Handler<T>,\n\t\toptions: HookOptions = {}\n\t): HookUnregister {\n\t\treturn this.on(hook, handler, { ...options, before: true });\n\t}\n\n\t/**\n\t * Register a new hook handler to replace the default handler.\n\t * Shortcut for `hooks.on(hook, handler, { replace: true })`.\n\t * @param hook Name of the hook to listen for\n\t * @param handler The handler function to execute instead of the default handler\n\t * @param options Any other event options (see `hooks.on()` for details)\n\t * @returns A function to unregister the handler\n\t * @see on\n\t */\n\treplace<T extends HookName>(hook: T, handler: Handler<T>): HookUnregister;\n\treplace<T extends HookName>(hook: T, handler: Handler<T>, options: HookOptions): HookUnregister;\n\treplace<T extends HookName>(\n\t\thook: T,\n\t\thandler: Handler<T>,\n\t\toptions: HookOptions = {}\n\t): HookUnregister {\n\t\treturn this.on(hook, handler, { ...options, replace: true });\n\t}\n\n\t/**\n\t * Register a new hook handler to run once.\n\t * Shortcut for `hooks.on(hook, handler, { once: true })`.\n\t * @param hook Name of the hook to listen for\n\t * @param handler The handler function to execute\n\t * @param options Any other event options (see `hooks.on()` for details)\n\t * @see on\n\t */\n\tonce<T extends HookName>(hook: T, handler: Handler<T>): HookUnregister;\n\tonce<T extends HookName>(hook: T, handler: Handler<T>, options: HookOptions): HookUnregister;\n\tonce<T extends HookName>(\n\t\thook: T,\n\t\thandler: Handler<T>,\n\t\toptions: HookOptions = {}\n\t): HookUnregister {\n\t\treturn this.on(hook, handler, { ...options, once: true });\n\t}\n\n\t/**\n\t * Unregister a hook handler.\n\t * @param hook Name of the hook the handler is registered for\n\t * @param handler The handler function that was registered.\n\t *                If omitted, all handlers for the hook will be removed.\n\t */\n\toff<T extends HookName>(hook: T): void;\n\toff<T extends HookName>(hook: T, handler: Handler<T>): void;\n\toff<T extends HookName>(hook: T, handler?: Handler<T>): void {\n\t\tconst ledger = this.get(hook);\n\t\tif (ledger && handler) {\n\t\t\tconst deleted = ledger.delete(handler);\n\t\t\tif (!deleted) {\n\t\t\t\tconsole.warn(`Handler for hook '${hook}' not found.`);\n\t\t\t}\n\t\t} else if (ledger) {\n\t\t\tledger.clear();\n\t\t}\n\t}\n\n\t/**\n\t * Trigger a hook asynchronously, executing its default handler and all registered handlers.\n\t * Will execute all handlers in order and `await` any `Promise`s they return.\n\t * @param hook Name of the hook to trigger\n\t * @param args Arguments to pass to the handler\n\t * @param defaultHandler A default implementation of this hook to execute\n\t * @returns The resolved return value of the executed default handler\n\t */\n\tasync call<T extends HookName>(\n\t\thook: T,\n\t\targs?: HookArguments<T>,\n\t\tdefaultHandler?: Handler<T>\n\t): Promise<any> {\n\t\tconst { before, handler, after } = this.getHandlers(hook, defaultHandler);\n\t\tawait this.run(before, args);\n\t\tconst [result] = await this.run(handler, args);\n\t\tawait this.run(after, args);\n\t\tthis.dispatchDomEvent(hook, args);\n\t\treturn result;\n\t}\n\n\t/**\n\t * Trigger a hook synchronously, executing its default handler and all registered handlers.\n\t * Will execute all handlers in order, but will **not** `await` any `Promise`s they return.\n\t * @param hook Name of the hook to trigger\n\t * @param args Arguments to pass to the handler\n\t * @param defaultHandler A default implementation of this hook to execute\n\t * @returns The (possibly unresolved) return value of the executed default handler\n\t */\n\tcallSync<T extends HookName>(\n\t\thook: T,\n\t\targs?: HookArguments<T>,\n\t\tdefaultHandler?: Handler<T>\n\t): any {\n\t\tconst { before, handler, after } = this.getHandlers(hook, defaultHandler);\n\t\tthis.runSync(before, args);\n\t\tconst [result] = this.runSync(handler, args);\n\t\tthis.runSync(after, args);\n\t\tthis.dispatchDomEvent(hook, args);\n\t\treturn result;\n\t}\n\n\t/**\n\t * Execute the handlers for a hook, in order, as `Promise`s that will be `await`ed.\n\t * @param registrations The registrations (handler + options) to execute\n\t * @param args Arguments to pass to the handler\n\t */\n\tprotected async run<T extends HookName>(\n\t\tregistrations: HookRegistration<T>[],\n\t\targs?: HookArguments<T>\n\t): Promise<any> {\n\t\tconst results = [];\n\t\tfor (const { hook, handler, defaultHandler, once } of registrations) {\n\t\t\tconst result = await runAsPromise(handler, [this.swup.visit, args, defaultHandler]);\n\t\t\tresults.push(result);\n\t\t\tif (once) {\n\t\t\t\tthis.off(hook, handler);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\t/**\n\t * Execute the handlers for a hook, in order, without `await`ing any returned `Promise`s.\n\t * @param registrations The registrations (handler + options) to execute\n\t * @param args Arguments to pass to the handler\n\t */\n\tprotected runSync<T extends HookName>(\n\t\tregistrations: HookRegistration<T>[],\n\t\targs?: HookArguments<T>\n\t): any[] {\n\t\tconst results = [];\n\t\tfor (const { hook, handler, defaultHandler, once } of registrations) {\n\t\t\tconst result = handler(this.swup.visit, args as HookArguments<T>, defaultHandler);\n\t\t\tresults.push(result);\n\t\t\tif (isPromise(result)) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`Promise returned from handler for synchronous hook '${hook}'.` +\n\t\t\t\t\t\t`Swup will not wait for it to resolve.`\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (once) {\n\t\t\t\tthis.off(hook, handler);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\t/**\n\t * Get all registered handlers for a hook, sorted by priority and registration order.\n\t * @param hook Name of the hook\n\t * @param defaultHandler The optional default handler of this hook\n\t * @returns An object with the handlers sorted into `before` and `after` arrays,\n\t *          as well as a flag indicating if the original handler was replaced\n\t */\n\tprotected getHandlers<T extends HookName>(hook: T, defaultHandler?: Handler<T>) {\n\t\tconst ledger = this.get(hook);\n\t\tif (!ledger) {\n\t\t\treturn { found: false, before: [], handler: [], after: [], replaced: false };\n\t\t}\n\n\t\tconst sort = this.sortRegistrations;\n\t\tconst registrations = Array.from(ledger.values());\n\n\t\t// Filter into before, after, and replace handlers\n\t\tconst before = registrations.filter(({ before, replace }) => before && !replace).sort(sort);\n\t\tconst replace = registrations.filter(({ replace }) => replace).sort(sort);\n\t\tconst after = registrations.filter(({ before, replace }) => !before && !replace).sort(sort);\n\t\tconst replaced = replace.length > 0;\n\n\t\t// Define main handler registration\n\t\t// This is an array to allow passing it into hooks.run() directly\n\t\tlet handler: HookRegistration<T>[] = [];\n\t\tif (defaultHandler) {\n\t\t\thandler = [{ id: 0, hook, handler: defaultHandler }];\n\t\t\tif (replaced) {\n\t\t\t\tconst index = replace.length - 1;\n\t\t\t\tconst replacingHandler = replace[index].handler;\n\t\t\t\tconst createDefaultHandler = (index: number): Handler<T> | undefined => {\n\t\t\t\t\tconst next = replace[index - 1];\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\treturn (visit, args) =>\n\t\t\t\t\t\t\tnext.handler(visit, args, createDefaultHandler(index - 1));\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn defaultHandler;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tconst nestedDefaultHandler = createDefaultHandler(index);\n\t\t\t\thandler = [\n\t\t\t\t\t{ id: 0, hook, handler: replacingHandler, defaultHandler: nestedDefaultHandler }\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\treturn { found: true, before, handler, after, replaced };\n\t}\n\n\t/**\n\t * Sort two hook registrations by priority and registration order.\n\t * @param a The registration object to compare\n\t * @param b The other registration object to compare with\n\t * @returns The sort direction\n\t */\n\tprotected sortRegistrations<T extends HookName>(\n\t\ta: HookRegistration<T>,\n\t\tb: HookRegistration<T>\n\t): number {\n\t\tconst priority = (a.priority ?? 0) - (b.priority ?? 0);\n\t\tconst id = a.id - b.id;\n\t\treturn priority || id || 0;\n\t}\n\n\t/**\n\t * Dispatch a custom event on the `document` for a hook. Prefixed with `swup:`\n\t * @param hook Name of the hook.\n\t */\n\tprotected dispatchDomEvent<T extends HookName>(hook: T, args?: HookArguments<T>): void {\n\t\tconst detail = { hook, args, visit: this.swup.visit };\n\t\tdocument.dispatchEvent(new CustomEvent(`swup:${hook}`, { detail }));\n\t}\n}\n","import { escapeCssIdentifier as escape, query } from '../utils.js';\n\n/**\n * Find the anchor element for a given hash.\n *\n * @param hash Hash with or without leading '#'\n * @returns The element, if found, or null.\n *\n * @see https://html.spec.whatwg.org/#find-a-potential-indicated-element\n */\nexport const getAnchorElement = (hash: string): Element | null => {\n\tif (hash && hash.charAt(0) === '#') {\n\t\thash = hash.substring(1);\n\t}\n\n\tif (!hash) {\n\t\treturn null;\n\t}\n\n\tconst decoded = decodeURIComponent(hash);\n\tlet element =\n\t\tdocument.getElementById(hash) ||\n\t\tdocument.getElementById(decoded) ||\n\t\tquery(`a[name='${escape(hash)}']`) ||\n\t\tquery(`a[name='${escape(decoded)}']`);\n\n\tif (!element && hash === 'top') {\n\t\telement = document.body;\n\t}\n\n\treturn element;\n};\n","import { queryAll, toMs } from '../utils.js';\nimport Swup, { Options } from '../Swup.js';\n\nconst TRANSITION = 'transition';\nconst ANIMATION = 'animation';\n\ntype AnimationTypes = typeof TRANSITION | typeof ANIMATION;\ntype AnimationProperties = 'Delay' | 'Duration';\ntype AnimationStyleKeys = `${AnimationTypes}${AnimationProperties}` | 'transitionProperty';\ntype AnimationStyleDeclarations = Pick<CSSStyleDeclaration, AnimationStyleKeys>;\n\nexport type AnimationDirection = 'in' | 'out';\n\n/**\n * Return a Promise that resolves when all CSS animations and transitions\n * are done on the page. Filters by selector or takes elements directly.\n */\nexport async function awaitAnimations(\n\tthis: Swup,\n\t{\n\t\telements,\n\t\tselector\n\t}: {\n\t\tselector: Options['animationSelector'];\n\t\telements?: NodeListOf<HTMLElement> | HTMLElement[];\n\t}\n): Promise<void> {\n\t// Allow usage of swup without animations: { animationSelector: false }\n\tif (selector === false && !elements) {\n\t\treturn;\n\t}\n\n\t// Allow passing in elements\n\tlet animatedElements: HTMLElement[] = [];\n\tif (elements) {\n\t\tanimatedElements = Array.from(elements);\n\t} else if (selector) {\n\t\tanimatedElements = queryAll(selector, document.body);\n\t\t// Warn if no elements match the selector, but keep things going\n\t\tif (!animatedElements.length) {\n\t\t\tconsole.warn(`[swup] No elements found matching animationSelector \\`${selector}\\``);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tconst awaitedAnimations = animatedElements.map((el) => awaitAnimationsOnElement(el));\n\tconst hasAnimations = awaitedAnimations.filter(Boolean).length > 0;\n\tif (!hasAnimations) {\n\t\tif (selector) {\n\t\t\tconsole.warn(\n\t\t\t\t`[swup] No CSS animation duration defined on elements matching \\`${selector}\\``\n\t\t\t);\n\t\t}\n\t\treturn;\n\t}\n\n\tawait Promise.all(awaitedAnimations);\n}\n\nfunction awaitAnimationsOnElement(element: Element): Promise<void> | false {\n\tconst { type, timeout, propCount } = getTransitionInfo(element);\n\n\t// Resolve immediately if no transition defined\n\tif (!type || !timeout) {\n\t\treturn false;\n\t}\n\n\treturn new Promise((resolve) => {\n\t\tconst endEvent = `${type}end`;\n\t\tconst startTime = performance.now();\n\t\tlet propsTransitioned = 0;\n\n\t\tconst end = () => {\n\t\t\telement.removeEventListener(endEvent, onEnd);\n\t\t\tresolve();\n\t\t};\n\n\t\tconst onEnd: EventListener = (event) => {\n\t\t\t// Skip transitions on child elements\n\t\t\tif (event.target !== element) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!isTransitionOrAnimationEvent(event)) {\n\t\t\t\tthrow new Error('Not a transition or animation event.');\n\t\t\t}\n\n\t\t\t// Skip transitions that happened before we started listening\n\t\t\tconst elapsedTime = (performance.now() - startTime) / 1000;\n\t\t\tif (elapsedTime < event.elapsedTime) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// End if all properties have transitioned\n\t\t\tif (++propsTransitioned >= propCount) {\n\t\t\t\tend();\n\t\t\t}\n\t\t};\n\n\t\tsetTimeout(() => {\n\t\t\tif (propsTransitioned < propCount) {\n\t\t\t\tend();\n\t\t\t}\n\t\t}, timeout + 1);\n\n\t\telement.addEventListener(endEvent, onEnd);\n\t});\n}\n\nexport function getTransitionInfo(element: Element, expectedType?: AnimationTypes) {\n\tconst styles = window.getComputedStyle(element) as AnimationStyleDeclarations;\n\n\tconst transitionDelays = getStyleProperties(styles, `${TRANSITION}Delay`);\n\tconst transitionDurations = getStyleProperties(styles, `${TRANSITION}Duration`);\n\tconst transitionTimeout = calculateTimeout(transitionDelays, transitionDurations);\n\tconst animationDelays = getStyleProperties(styles, `${ANIMATION}Delay`);\n\tconst animationDurations = getStyleProperties(styles, `${ANIMATION}Duration`);\n\tconst animationTimeout = calculateTimeout(animationDelays, animationDurations);\n\n\tlet type: AnimationTypes | null = null;\n\tlet timeout = 0;\n\tlet propCount = 0;\n\n\tif (expectedType === TRANSITION) {\n\t\tif (transitionTimeout > 0) {\n\t\t\ttype = TRANSITION;\n\t\t\ttimeout = transitionTimeout;\n\t\t\tpropCount = transitionDurations.length;\n\t\t}\n\t} else if (expectedType === ANIMATION) {\n\t\tif (animationTimeout > 0) {\n\t\t\ttype = ANIMATION;\n\t\t\ttimeout = animationTimeout;\n\t\t\tpropCount = animationDurations.length;\n\t\t}\n\t} else {\n\t\ttimeout = Math.max(transitionTimeout, animationTimeout);\n\t\ttype = timeout > 0 ? (transitionTimeout > animationTimeout ? TRANSITION : ANIMATION) : null;\n\t\tpropCount = type\n\t\t\t? type === TRANSITION\n\t\t\t\t? transitionDurations.length\n\t\t\t\t: animationDurations.length\n\t\t\t: 0;\n\t}\n\n\treturn {\n\t\ttype,\n\t\ttimeout,\n\t\tpropCount\n\t};\n}\n\nfunction isTransitionOrAnimationEvent(event: any): event is TransitionEvent | AnimationEvent {\n\treturn [`${TRANSITION}end`, `${ANIMATION}end`].includes(event.type);\n}\n\nfunction getStyleProperties(styles: AnimationStyleDeclarations, key: AnimationStyleKeys): string[] {\n\treturn (styles[key] || '').split(', ');\n}\n\nfunction calculateTimeout(delays: string[], durations: string[]): number {\n\twhile (delays.length < durations.length) {\n\t\tdelays = delays.concat(delays);\n\t}\n\n\treturn Math.max(...durations.map((duration, i) => toMs(duration) + toMs(delays[i])));\n}\n","import Swup from '../Swup.js';\nimport { createHistoryRecord, updateHistoryRecord, getCurrentUrl, Location } from '../helpers.js';\nimport { FetchOptions } from './fetchPage.js';\nimport { VisitInitOptions } from './Visit.js';\n\nexport type HistoryAction = 'push' | 'replace';\nexport type HistoryDirection = 'forwards' | 'backwards';\n\n/** Define how to navigate to a page. */\ntype NavigationOptions = {\n\t/** Whether this visit is animated. Default: `true` */\n\tanimate?: boolean;\n\t/** Name of a custom animation to run. */\n\tanimation?: string;\n\t/** History action to perform: `push` for creating a new history entry, `replace` for replacing the current entry. Default: `push` */\n\thistory?: HistoryAction;\n};\n\n/**\n * Navigate to a new URL.\n * @param url The URL to navigate to.\n * @param options Options for how to perform this visit.\n * @returns Promise<void>\n */\nexport function navigate(\n\tthis: Swup,\n\turl: string,\n\toptions: NavigationOptions & FetchOptions = {},\n\tinit: Omit<VisitInitOptions, 'to'> = {}\n) {\n\t// Check if the visit should be ignored\n\tif (this.shouldIgnoreVisit(url, { el: init.el, event: init.event })) {\n\t\twindow.location.href = url;\n\t\treturn;\n\t}\n\n\tconst { url: to, hash } = Location.fromUrl(url);\n\tthis.visit = this.createVisit({ ...init, to, hash });\n\tthis.performNavigation(to, options);\n}\n\n/**\n * Start a visit to a new URL.\n *\n * Internal method that assumes the visit context has already been created.\n *\n * As a user, you should call `swup.navigate(url)` instead.\n *\n * @param url The URL to navigate to.\n * @param options Options for how to perform this visit.\n * @returns Promise<void>\n */\nexport async function performNavigation(\n\tthis: Swup,\n\turl: string,\n\toptions: NavigationOptions & FetchOptions = {}\n) {\n\tif (typeof url !== 'string') {\n\t\tthrow new Error(`swup.navigate() requires a URL parameter`);\n\t}\n\n\tconst { el } = this.visit.trigger;\n\tthis.visit.to.url = Location.fromUrl(url).url;\n\toptions.referrer = options.referrer || this.currentPageUrl;\n\n\tif (options.animate === false) {\n\t\tthis.visit.animation.animate = false;\n\t}\n\n\t// Clean up old animation classes\n\tif (!this.visit.animation.animate) {\n\t\tthis.classes.clear();\n\t}\n\n\t// Get history action from option or attribute on trigger element\n\tconst history = options.history || el?.getAttribute('data-swup-history') || undefined;\n\tif (history && ['push', 'replace'].includes(history)) {\n\t\tthis.visit.history.action = history as HistoryAction;\n\t}\n\n\t// Get custom animation name from option or attribute on trigger element\n\tconst animation = options.animation || el?.getAttribute('data-swup-animation') || undefined;\n\tif (animation) {\n\t\tthis.visit.animation.name = animation;\n\t}\n\n\ttry {\n\t\tawait this.hooks.call('visit:start');\n\n\t\t// Begin loading page\n\t\tconst pagePromise = this.hooks.call('page:load', { options }, async (visit, args) => {\n\t\t\tconst cachedPage = this.cache.get(visit.to.url!);\n\t\t\targs.page = cachedPage || (await this.fetchPage(visit.to.url!, args.options));\n\t\t\targs.cache = !!cachedPage;\n\t\t\treturn args.page;\n\t\t});\n\n\t\t// Create history record if this is not a popstate call (with or without anchor)\n\t\tif (!this.visit.history.popstate) {\n\t\t\tconst newUrl = url + (this.visit.scroll.target || '');\n\t\t\tif (this.visit.history.action === 'replace') {\n\t\t\t\tupdateHistoryRecord(newUrl);\n\t\t\t} else {\n\t\t\t\tconst index = this.currentHistoryIndex + 1;\n\t\t\t\tcreateHistoryRecord(newUrl, { index });\n\t\t\t}\n\t\t}\n\n\t\tthis.currentPageUrl = getCurrentUrl();\n\n\t\t// Wait for page before starting to animate out?\n\t\tif (this.visit.animation.wait) {\n\t\t\tconst { html } = await pagePromise;\n\t\t\tthis.visit.to.html = html;\n\t\t}\n\n\t\t// Wait for page to load and leave animation to finish\n\t\tconst animationPromise = this.animatePageOut();\n\t\tconst [page] = await Promise.all([pagePromise, animationPromise]);\n\n\t\t// Render page: replace content and scroll to top/fragment\n\t\tawait this.renderPage(this.visit.to.url, page);\n\n\t\t// Wait for enter animation\n\t\tawait this.animatePageIn();\n\n\t\t// Finalize visit\n\t\tawait this.hooks.call('visit:end', undefined, () => this.classes.clear());\n\n\t\t// Reset visit info after finish?\n\t\t// if (this.visit.to && this.isSameResolvedUrl(this.visit.to.url, requestedUrl)) {\n\t\t// \tthis.createVisit({ to: undefined });\n\t\t// }\n\t} catch (error: unknown) {\n\t\t// Return early if error is undefined (probably aborted preload request)\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Log to console as we swallow almost all hook errors\n\t\tconsole.error(error);\n\n\t\t// Rewrite `skipPopStateHandling` to redirect manually when `history.go` is processed\n\t\tthis.options.skipPopStateHandling = () => {\n\t\t\twindow.location.href = this.visit.to.url as string;\n\t\t\treturn true;\n\t\t};\n\n\t\t// Go back to the actual page we're still at\n\t\twindow.history.go(-1);\n\t}\n}\n","import Swup from '../Swup.js';\nimport { Location } from '../helpers.js';\n\n/** A page object as used by swup and its cache. */\nexport interface PageData {\n\t/** The URL of the page */\n\turl: string;\n\t/** The complete HTML response received from the server */\n\thtml: string;\n}\n\n/** Define how a page is fetched. */\nexport interface FetchOptions extends RequestInit {\n\t/** The request method. */\n\tmethod?: 'GET' | 'POST';\n\t/** The body of the request: raw string, form data object or URL params. */\n\tbody?: string | FormData | URLSearchParams;\n\t/** The headers of the request: key/value object. */\n\theaders?: Record<string, string>;\n}\n\nexport class FetchError extends Error {\n\turl: string;\n\tstatus: number;\n\tconstructor(message: string, details: { url: string; status: number }) {\n\t\tsuper(message);\n\t\tthis.name = 'FetchError';\n\t\tthis.url = details.url;\n\t\tthis.status = details.status;\n\t}\n}\n\n/**\n * Fetch a page from the server, return it and cache it.\n */\nexport async function fetchPage(\n\tthis: Swup,\n\turl: URL | string,\n\toptions: FetchOptions = {}\n): Promise<PageData> {\n\turl = Location.fromUrl(url).url;\n\n\tconst headers = { ...this.options.requestHeaders, ...options.headers };\n\toptions = { ...options, headers };\n\n\t// Allow hooking before this and returning a custom response-like object (e.g. custom fetch implementation)\n\tconst response: Response = await this.hooks.call(\n\t\t'fetch:request',\n\t\t{ url, options },\n\t\t(visit, { url, options }) => fetch(url, options)\n\t);\n\n\tconst { status, url: responseUrl } = response;\n\tconst html = await response.text();\n\n\tif (status === 500) {\n\t\tthis.hooks.call('fetch:error', { status, response, url: responseUrl });\n\t\tthrow new FetchError(`Server error: ${responseUrl}`, { status, url: responseUrl });\n\t}\n\n\tif (!html) {\n\t\tthrow new FetchError(`Empty response: ${responseUrl}`, { status, url: responseUrl });\n\t}\n\n\t// Resolve real url after potential redirect\n\tconst { url: finalUrl } = Location.fromUrl(responseUrl);\n\tconst page = { url: finalUrl, html };\n\n\t// Only save cache entry for non-redirects\n\tif (url === finalUrl) {\n\t\tthis.cache.set(page.url, page);\n\t}\n\n\treturn page;\n}\n","import Swup from '../Swup.js';\nimport { classify } from '../helpers.js';\n\n/**\n * Perform the out/leave animation of the current page.\n * @returns Promise<void>\n */\nexport const animatePageOut = async function (this: Swup) {\n\tif (!this.visit.animation.animate) {\n\t\tawait this.hooks.call('animation:skip');\n\t\treturn;\n\t}\n\n\tawait this.hooks.call('animation:out:start', undefined, (visit) => {\n\t\tthis.classes.add('is-changing', 'is-leaving', 'is-animating');\n\t\tif (visit.history.popstate) {\n\t\t\tthis.classes.add('is-popstate');\n\t\t}\n\t\tif (visit.animation.name) {\n\t\t\tthis.classes.add(`to-${classify(visit.animation.name)}`);\n\t\t}\n\t});\n\n\tawait this.hooks.call('animation:out:await', { skip: false }, async (visit, { skip }) => {\n\t\tif (skip) return;\n\t\tawait this.awaitAnimations({ selector: visit.animation.selector });\n\t});\n\n\tawait this.hooks.call('animation:out:end');\n};\n","import Swup, { Options } from '../Swup.js';\nimport { PageData } from './fetchPage.js';\n\n/**\n * Perform the replacement of content after loading a page.\n *\n * It takes an object with the page data as returned from `fetchPage` and a list\n * of container selectors to replace.\n *\n * @returns Whether all containers were replaced.\n */\nexport const replaceContent = function (\n\tthis: Swup,\n\t{ html }: PageData,\n\t{ containers }: { containers: Options['containers'] } = this.options\n): boolean {\n\tconst incomingDocument = new DOMParser().parseFromString(html, 'text/html');\n\n\t// Update browser title\n\tconst title = incomingDocument.querySelector('title')?.innerText || '';\n\tdocument.title = title;\n\n\t// Update content containers\n\tconst replaced = containers\n\t\t.map((selector) => {\n\t\t\tconst currentEl = document.querySelector(selector);\n\t\t\tconst incomingEl = incomingDocument.querySelector(selector);\n\t\t\tif (currentEl && incomingEl) {\n\t\t\t\tcurrentEl.replaceWith(incomingEl);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (!currentEl) {\n\t\t\t\tconsole.warn(`[swup] Container missing in current document: ${selector}`);\n\t\t\t}\n\t\t\tif (!incomingEl) {\n\t\t\t\tconsole.warn(`[swup] Container missing in incoming document: ${selector}`);\n\t\t\t}\n\t\t\treturn false;\n\t\t})\n\t\t.filter(Boolean);\n\n\treturn replaced.length === containers.length;\n};\n","import Swup from '../Swup.js';\n\n/**\n * Update the scroll position after page render.\n * @returns Promise<boolean>\n */\nexport const scrollToContent = function (this: Swup): boolean {\n\tconst options: ScrollIntoViewOptions = { behavior: 'auto' };\n\tconst { target, reset } = this.visit.scroll;\n\tlet scrolled = false;\n\n\tif (target) {\n\t\tscrolled = this.hooks.callSync(\n\t\t\t'scroll:anchor',\n\t\t\t{ hash: target, options },\n\t\t\t(visit, { hash, options }) => {\n\t\t\t\tconst anchor = this.getAnchorElement(hash || '');\n\t\t\t\tif (anchor) {\n\t\t\t\t\tanchor.scrollIntoView(options);\n\t\t\t\t}\n\t\t\t\treturn !!anchor;\n\t\t\t}\n\t\t);\n\t}\n\n\tif (reset && !scrolled) {\n\t\tscrolled = this.hooks.callSync('scroll:top', { options }, (visit, { options }) => {\n\t\t\twindow.scrollTo({ top: 0, left: 0, ...options });\n\t\t\treturn true;\n\t\t});\n\t}\n\n\treturn scrolled;\n};\n","import Swup from '../Swup.js';\nimport { nextTick } from '../utils.js';\n\n/**\n * Perform the in/enter animation of the next page.\n * @returns Promise<void>\n */\nexport const animatePageIn = async function (this: Swup) {\n\tif (!this.visit.animation.animate) {\n\t\treturn;\n\t}\n\n\tconst animation = this.hooks.call(\n\t\t'animation:in:await',\n\t\t{ skip: false },\n\t\tasync (visit, { skip }) => {\n\t\t\tif (skip) return;\n\t\t\tawait this.awaitAnimations({ selector: visit.animation.selector });\n\t\t}\n\t);\n\n\tawait nextTick();\n\n\tawait this.hooks.call('animation:in:start', undefined, () => {\n\t\tthis.classes.remove('is-animating');\n\t});\n\n\tawait animation;\n\n\tawait this.hooks.call('animation:in:end');\n};\n","import { updateHistoryRecord, getCurrentUrl, classify } from '../helpers.js';\nimport Swup from '../Swup.js';\nimport { PageData } from './fetchPage.js';\n\n/**\n * Render the next page: replace the content and update scroll position.\n * @returns Promise<void>\n */\nexport const renderPage = async function (this: Swup, requestedUrl: string, page: PageData) {\n\tconst { url, html } = page;\n\n\tthis.classes.remove('is-leaving');\n\n\t// do nothing if another page was requested in the meantime\n\tif (!this.isSameResolvedUrl(getCurrentUrl(), requestedUrl)) {\n\t\treturn;\n\t}\n\n\t// update state if the url was redirected\n\tif (!this.isSameResolvedUrl(getCurrentUrl(), url)) {\n\t\tupdateHistoryRecord(url);\n\t\tthis.currentPageUrl = getCurrentUrl();\n\t\tthis.visit.to.url = this.currentPageUrl;\n\t}\n\n\t// only add for animated page loads\n\tif (this.visit.animation.animate) {\n\t\tthis.classes.add('is-rendering');\n\t}\n\n\t// save html into visit context for easier retrieval\n\tthis.visit.to.html = html;\n\n\t// replace content: allow handlers and plugins to overwrite paga data and containers\n\tawait this.hooks.call('content:replace', { page }, (visit, { page }) => {\n\t\tconst success = this.replaceContent(page, { containers: visit.containers });\n\t\tif (!success) {\n\t\t\tthrow new Error('[swup] Container mismatch, aborting');\n\t\t}\n\t\tif (visit.animation.animate) {\n\t\t\t// Make sure to add these classes to new containers as well\n\t\t\tthis.classes.add('is-animating', 'is-changing', 'is-rendering');\n\t\t\tif (visit.animation.name) {\n\t\t\t\tthis.classes.add(`to-${classify(visit.animation.name)}`);\n\t\t\t}\n\t\t}\n\t});\n\n\t// scroll into view: either anchor or top of page\n\tawait this.hooks.call('content:scroll', undefined, () => {\n\t\treturn this.scrollToContent();\n\t});\n\n\tawait this.hooks.call('page:view', { url: this.currentPageUrl, title: document.title });\n\n\t// empty cache if it's disabled (in case preload plugin filled it)\n\tif (!this.options.cache) {\n\t\tthis.cache.clear();\n\t}\n};\n","import Swup from '../Swup.js';\n\nexport type Plugin = {\n\t/** Identify as a swup plugin */\n\tisSwupPlugin: true;\n\t/** Name of this plugin */\n\tname: string;\n\t/** Version of this plugin. Currently not in use, defined here for backward compatiblity. */\n\tversion?: string;\n\t/** The swup instance that mounted this plugin */\n\tswup?: Swup;\n\t/** Version requirements of this plugin. Example: `{ swup: '>=4' }` */\n\trequires?: Record<string, string | string[]>;\n\t/** Run on mount */\n\tmount: () => void;\n\t/** Run on unmount */\n\tunmount: () => void;\n\t_beforeMount?: () => void;\n\t_afterUnmount?: () => void;\n\t_checkRequirements?: () => boolean;\n};\n\nconst isSwupPlugin = (maybeInvalidPlugin: unknown): maybeInvalidPlugin is Plugin => {\n\t// @ts-ignore\n\treturn maybeInvalidPlugin?.isSwupPlugin;\n};\n\n/** Install a plugin. */\nexport const use = function (this: Swup, plugin: unknown) {\n\tif (!isSwupPlugin(plugin)) {\n\t\tconsole.error('Not a swup plugin instance', plugin);\n\t\treturn;\n\t}\n\n\tplugin.swup = this;\n\tif (plugin._checkRequirements) {\n\t\tif (!plugin._checkRequirements()) {\n\t\t\treturn;\n\t\t}\n\t}\n\tif (plugin._beforeMount) {\n\t\tplugin._beforeMount();\n\t}\n\tplugin.mount();\n\n\tthis.plugins.push(plugin);\n\n\treturn this.plugins;\n};\n\n/** Uninstall a plugin. */\nexport function unuse(this: Swup, pluginOrName: Plugin | string) {\n\tconst plugin = this.findPlugin(pluginOrName);\n\tif (!plugin) {\n\t\tconsole.error('No such plugin', plugin);\n\t\treturn;\n\t}\n\n\tplugin.unmount();\n\tif (plugin._afterUnmount) {\n\t\tplugin._afterUnmount();\n\t}\n\n\tthis.plugins = this.plugins.filter((p) => p !== plugin);\n\n\treturn this.plugins;\n}\n\n/** Find a plugin by name or reference. */\nexport function findPlugin(this: Swup, pluginOrName: Plugin | string) {\n\treturn this.plugins.find(\n\t\t(plugin) =>\n\t\t\tplugin === pluginOrName ||\n\t\t\tplugin.name === pluginOrName ||\n\t\t\tplugin.name === `Swup${pluginOrName}`\n\t);\n}\n","import Swup from '../Swup.js';\n\n/**\n * Utility function to validate and run the global option 'resolveUrl'\n * @param {string} url\n * @returns {string} the resolved url\n */\nexport function resolveUrl(this: Swup, url: string): string {\n\tif (typeof this.options.resolveUrl !== 'function') {\n\t\tconsole.warn(`[swup] options.resolveUrl expects a callback function.`);\n\t\treturn url;\n\t}\n\tconst result = this.options.resolveUrl(url);\n\tif (!result || typeof result !== 'string') {\n\t\tconsole.warn(`[swup] options.resolveUrl needs to return a url`);\n\t\treturn url;\n\t}\n\tif (result.startsWith('//') || result.startsWith('http')) {\n\t\tconsole.warn(`[swup] options.resolveUrl needs to return a relative url`);\n\t\treturn url;\n\t}\n\treturn result;\n}\n\n/**\n * Compares the resolved version of two paths and returns true if they are the same\n * @param {string} url1\n * @param {string} url2\n * @returns {boolean}\n */\nexport function isSameResolvedUrl(this: Swup, url1: string, url2: string): boolean {\n\treturn this.resolveUrl(url1) === this.resolveUrl(url2);\n}\n","import { DelegateEvent } from 'delegate-it';\n\nimport version from './config/version.js';\n\nimport { delegateEvent, getCurrentUrl, Location, updateHistoryRecord } from './helpers.js';\nimport { DelegateEventUnsubscribe } from './helpers/delegateEvent.js';\n\nimport { Cache } from './modules/Cache.js';\nimport { Classes } from './modules/Classes.js';\nimport { Visit, createVisit } from './modules/Visit.js';\nimport { Hooks } from './modules/Hooks.js';\nimport { getAnchorElement } from './modules/getAnchorElement.js';\nimport { awaitAnimations } from './modules/awaitAnimations.js';\nimport { navigate, performNavigation } from './modules/navigate.js';\nimport { fetchPage } from './modules/fetchPage.js';\nimport { animatePageOut } from './modules/animatePageOut.js';\nimport { replaceContent } from './modules/replaceContent.js';\nimport { scrollToContent } from './modules/scrollToContent.js';\nimport { animatePageIn } from './modules/animatePageIn.js';\nimport { renderPage } from './modules/renderPage.js';\nimport { use, unuse, findPlugin, Plugin } from './modules/plugins.js';\nimport { isSameResolvedUrl, resolveUrl } from './modules/resolveUrl.js';\nimport { nextTick } from './utils.js';\n\n/** Options for customizing swup's behavior. */\nexport type Options = {\n\t/** Whether history visits are animated. Default: `false` */\n\tanimateHistoryBrowsing: boolean;\n\t/** Selector for detecting animation timing. Default: `[class*=\"transition-\"]` */\n\tanimationSelector: string | false;\n\t/** Elements on which to add animation classes. Default: `html` element */\n\tanimationScope: 'html' | 'containers';\n\t/** Enable in-memory page cache. Default: `true` */\n\tcache: boolean;\n\t/** Content containers to be replaced on page visits. Default: `['#swup']` */\n\tcontainers: string[];\n\t/** Callback for ignoring visits. Receives the element and event that triggered the visit. */\n\tignoreVisit: (url: string, { el, event }: { el?: Element; event?: Event }) => boolean;\n\t/** Selector for links that trigger visits. Default: `'a[href]'` */\n\tlinkSelector: string;\n\t/** Plugins to register on startup. */\n\tplugins: Plugin[];\n\t/** Custom headers sent along with fetch requests. */\n\trequestHeaders: Record<string, string>;\n\t/** Rewrite URLs before loading them. */\n\tresolveUrl: (url: string) => string;\n\t/** Callback for telling swup to ignore certain popstate events.  */\n\tskipPopStateHandling: (event: any) => boolean;\n};\n\nconst defaults: Options = {\n\tanimateHistoryBrowsing: false,\n\tanimationSelector: '[class*=\"transition-\"]',\n\tanimationScope: 'html',\n\tcache: true,\n\tcontainers: ['#swup'],\n\tignoreVisit: (url, { el, event } = {}) => !!el?.closest('[data-no-swup]'),\n\tlinkSelector: 'a[href]',\n\tplugins: [],\n\tresolveUrl: (url) => url,\n\trequestHeaders: {\n\t\t'X-Requested-With': 'swup',\n\t\t'Accept': 'text/html, application/xhtml+xml'\n\t},\n\tskipPopStateHandling: (event) => event.state?.source !== 'swup'\n};\n\n/** Swup page transition library. */\nexport default class Swup {\n\t/** Library version */\n\treadonly version: string = version;\n\t/** Options passed into the instance */\n\toptions: Options;\n\t/** Default options before merging user options */\n\treadonly defaults: Options = defaults;\n\t/** Registered plugin instances */\n\tplugins: Plugin[] = [];\n\t/** Data about the current visit */\n\tvisit: Visit;\n\t/** Cache instance */\n\treadonly cache: Cache;\n\t/** Hook registry */\n\treadonly hooks: Hooks;\n\t/** Animation class manager */\n\treadonly classes: Classes;\n\t/** URL of the currently visible page */\n\tcurrentPageUrl: string = getCurrentUrl();\n\t/** Index of the current history entry */\n\tprotected currentHistoryIndex = 1;\n\t/** Delegated event subscription handle */\n\tprotected clickDelegate?: DelegateEventUnsubscribe;\n\n\t/** Install a plugin */\n\tuse = use;\n\t/** Uninstall a plugin */\n\tunuse = unuse;\n\t/** Find a plugin by name or instance */\n\tfindPlugin = findPlugin;\n\n\t/** Log a message. Has no effect unless debug plugin is installed */\n\tlog: (message: string, context?: any) => void = () => {};\n\n\t/** Navigate to a new URL */\n\tnavigate = navigate;\n\t/** Actually perform a navigation */\n\tprotected performNavigation = performNavigation;\n\t/** Create a new context for this visit */\n\tprotected createVisit = createVisit;\n\t/** Register a delegated event listener */\n\tdelegateEvent = delegateEvent;\n\t/** Fetch a page from the server */\n\tfetchPage = fetchPage;\n\t/** Resolve when animations on the page finish */\n\tawaitAnimations = awaitAnimations;\n\tprotected renderPage = renderPage;\n\t/** Replace the content after page load */\n\treplaceContent = replaceContent;\n\tprotected animatePageIn = animatePageIn;\n\tprotected animatePageOut = animatePageOut;\n\tprotected scrollToContent = scrollToContent;\n\t/** Find the anchor element for a given hash */\n\tgetAnchorElement = getAnchorElement;\n\n\t/** Get the current page URL */\n\tgetCurrentUrl = getCurrentUrl;\n\t/** Resolve a URL to its final location */\n\tresolveUrl = resolveUrl;\n\t/** Check if two URLs resolve to the same location */\n\tprotected isSameResolvedUrl = isSameResolvedUrl;\n\n\tconstructor(options: Partial<Options> = {}) {\n\t\t// Merge defaults and options\n\t\tthis.options = { ...this.defaults, ...options };\n\n\t\tthis.handleLinkClick = this.handleLinkClick.bind(this);\n\t\tthis.handlePopState = this.handlePopState.bind(this);\n\n\t\tthis.cache = new Cache(this);\n\t\tthis.classes = new Classes(this);\n\t\tthis.hooks = new Hooks(this);\n\t\tthis.visit = this.createVisit({ to: undefined });\n\n\t\tif (!this.checkRequirements()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enable();\n\t}\n\n\tprotected checkRequirements() {\n\t\tif (typeof Promise === 'undefined') {\n\t\t\tconsole.warn('Promise is not supported');\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/** Enable this instance, adding listeners and classnames. */\n\tasync enable() {\n\t\t// Add event listener\n\t\tconst { linkSelector } = this.options;\n\t\tthis.clickDelegate = this.delegateEvent(linkSelector, 'click', this.handleLinkClick);\n\n\t\twindow.addEventListener('popstate', this.handlePopState);\n\n\t\t// Initial save to cache\n\t\tif (this.options.cache) {\n\t\t\t// Disabled to avoid caching modified dom state: logic moved to preload plugin\n\t\t\t// https://github.com/swup/swup/issues/475\n\t\t}\n\n\t\t// Mount plugins\n\t\tthis.options.plugins.forEach((plugin) => this.use(plugin));\n\n\t\t// Modify initial history record\n\t\tupdateHistoryRecord(null, { index: 1 });\n\n\t\t// Give consumers a chance to hook into enable\n\t\tawait nextTick();\n\n\t\t// Trigger enable hook\n\t\tawait this.hooks.call('enable', undefined, () => {\n\t\t\t// Add swup-enabled class to html tag\n\t\t\tdocument.documentElement.classList.add('swup-enabled');\n\t\t});\n\t}\n\n\t/** Disable this instance, removing listeners and classnames. */\n\tasync destroy() {\n\t\t// remove delegated listener\n\t\tthis.clickDelegate!.destroy();\n\n\t\t// remove popstate listener\n\t\twindow.removeEventListener('popstate', this.handlePopState);\n\n\t\t// empty cache\n\t\tthis.cache.clear();\n\n\t\t// unmount plugins\n\t\tthis.options.plugins.forEach((plugin) => this.unuse(plugin));\n\n\t\t// trigger disable hook\n\t\tawait this.hooks.call('disable', undefined, () => {\n\t\t\t// remove swup-enabled class from html tag\n\t\t\tdocument.documentElement.classList.remove('swup-enabled');\n\t\t});\n\n\t\t// remove handlers\n\t\tthis.hooks.clear();\n\t}\n\n\t/** Determine if a visit should be ignored by swup, based on URL or trigger element. */\n\tshouldIgnoreVisit(href: string, { el, event }: { el?: Element; event?: Event } = {}) {\n\t\tconst { origin, url, hash } = Location.fromUrl(href);\n\n\t\t// Ignore if the new origin doesn't match the current one\n\t\tif (origin !== window.location.origin) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Ignore if the link/form would open a new window (or none at all)\n\t\tif (el && this.triggerWillOpenNewWindow(el)) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Ignore if the visit should be ignored as per user options\n\t\tif (this.options.ignoreVisit(url + hash, { el, event })) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Finally, allow the visit\n\t\treturn false;\n\t}\n\n\tprotected handleLinkClick(event: DelegateEvent<MouseEvent>) {\n\t\tconst el = event.delegateTarget as HTMLAnchorElement;\n\t\tconst { href, url, hash } = Location.fromElement(el);\n\n\t\t// Exit early if the link should be ignored\n\t\tif (this.shouldIgnoreVisit(href, { el, event })) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.visit = this.createVisit({ to: url, hash, el, event });\n\n\t\t// Exit early if control key pressed\n\t\tif (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\n\t\t\tthis.hooks.call('link:newtab', { href });\n\t\t\treturn;\n\t\t}\n\n\t\t// Exit early if other than left mouse button\n\t\tif (event.button !== 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hooks.callSync('link:click', { el, event }, () => {\n\t\t\tconst from = this.visit.from.url ?? '';\n\n\t\t\tevent.preventDefault();\n\n\t\t\t// Handle links to the same page: with or without hash\n\t\t\tif (!url || url === from) {\n\t\t\t\tif (hash) {\n\t\t\t\t\tthis.hooks.callSync('link:anchor', { hash }, () => {\n\t\t\t\t\t\tupdateHistoryRecord(url + hash);\n\t\t\t\t\t\tthis.scrollToContent();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.hooks.callSync('link:self', undefined, () => {\n\t\t\t\t\t\tthis.scrollToContent();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Exit early if the resolved path hasn't changed\n\t\t\tif (this.isSameResolvedUrl(url, from)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Finally, proceed with loading the page\n\t\t\tthis.performNavigation(url);\n\t\t});\n\t}\n\n\tprotected handlePopState(event: PopStateEvent) {\n\t\tconst href = event.state?.url ?? location.href;\n\n\t\t// Exit early if this event should be ignored\n\t\tif (this.options.skipPopStateHandling(event)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Exit early if the resolved path hasn't changed\n\t\tif (this.isSameResolvedUrl(getCurrentUrl(), this.currentPageUrl)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Exit early if the link should be ignored\n\t\tif (this.shouldIgnoreVisit(href, { event })) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { url, hash } = Location.fromUrl(href);\n\t\tconst animate = this.options.animateHistoryBrowsing;\n\t\tconst resetScroll = this.options.animateHistoryBrowsing;\n\n\t\tthis.visit = this.createVisit({\n\t\t\tto: url,\n\t\t\thash,\n\t\t\tevent,\n\t\t\tanimate,\n\t\t\tresetScroll\n\t\t});\n\n\t\t// Mark as popstate visit\n\t\tthis.visit.history.popstate = true;\n\n\t\t// Determine direction of history visit\n\t\tconst index = Number(event.state?.index);\n\t\tif (index) {\n\t\t\tconst direction = index - this.currentHistoryIndex > 0 ? 'forwards' : 'backwards';\n\t\t\tthis.visit.history.direction = direction;\n\t\t}\n\n\t\t// Does this even do anything?\n\t\t// if (!hash) {\n\t\t// \tevent.preventDefault();\n\t\t// }\n\n\t\tthis.hooks.callSync('history:popstate', { event }, () => {\n\t\t\tthis.performNavigation(url);\n\t\t});\n\t}\n\n\t/** Determine whether an element will open a new tab when clicking/activating. */\n\tprotected triggerWillOpenNewWindow(triggerEl: Element) {\n\t\tif (triggerEl.matches('[download], [target=\"_blank\"]')) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n"],"names":["classify","text","fallback","String","toLowerCase","replace","getCurrentUrl","_temp","hash","location","pathname","search","createHistoryRecord","url","customData","data","random","Math","source","history","pushState","updateHistoryRecord","state","replaceState","ledger","WeakMap","editLedger","wanted","baseElement","callback","setup","has","elementMap","get","set","setups","Set","existed","add","delete","delegateEvent","selector","type","options","controller","AbortController","signal","base","document","aborted","once","nativeListenerOptions","Document","documentElement","capture","Boolean","listenerFn","event","delegateTarget","target","Text","parentElement","Element","currentTarget","closest","contains","safeClosest","Object","assign","call","removeEventListener","JSON","stringify","addEventListener","delegate","destroy","abort","Location","URL","constructor","baseURI","super","toString","this","fromElement","el","href","getAttribute","fromUrl","Cache","swup","pages","Map","size","all","copy","forEach","page","key","resolve","result","hooks","callSync","update","payload","clear","prune","predicate","urlToResolve","resolveUrl","query","context","querySelector","queryAll","Array","from","querySelectorAll","nextTick","Promise","requestAnimationFrame","isPromise","obj","then","escapeCssIdentifier","ident","window","CSS","escape","toMs","s","Number","slice","Classes","swupClasses","selectors","scope","visit","animation","containers","isArray","join","targets","trim","classList","arguments","remove","className","split","filter","c","isSwupClass","some","startsWith","createVisit","_ref","to","currentPageUrl","animate","name","action","resetScroll","reset","wait","animationScope","animationSelector","trigger","popstate","direction","undefined","scroll","pact","value","_Pact","o","_settle","bind","v","observer","onFulfilled","onRejected","e","_this","_isSettledPact","thenable","Hooks","registry","init","hook","create","exists","console","error","on","handler","warn","id","registration","off","before","args","defaultHandler","after","getHandlers","run","dispatchDomEvent","reject","runSync","registrations","_this2","results","body","check","_iteratorSymbol","step","iterator","_cycle","next","done","return","_fixup","TypeError","values","i","length","push","array","_forTo","_forOf","_ref2","func","runAsPromise","found","replaced","sort","sortRegistrations","_ref3","_ref4","_ref5","index","createDefaultHandler","a","b","priority","dispatchEvent","CustomEvent","detail","getAnchorElement","charAt","substring","decoded","decodeURIComponent","element","getElementById","awaitAnimations","elements","animatedElements","awaitedAnimations","map","timeout","propCount","expectedType","styles","getComputedStyle","transitionDelays","getStyleProperties","TRANSITION","transitionDurations","transitionTimeout","calculateTimeout","animationDelays","ANIMATION","animationDurations","animationTimeout","max","getTransitionInfo","endEvent","startTime","performance","now","propsTransitioned","end","onEnd","includes","isTransitionOrAnimationEvent","Error","elapsedTime","setTimeout","awaitAnimationsOnElement","delays","durations","concat","duration","performNavigation","referrer","classes","_temp2","animationPromise","animatePageOut","pagePromise","renderPage","animatePageIn","_temp3","_this$fetchPage","cache","cachedPage","fetchPage","newUrl","currentHistoryIndex","html","_catch","skipPopStateHandling","go","navigate","shouldIgnoreVisit","headers","requestHeaders","fetch","response","status","responseUrl","FetchError","finalUrl","message","details","_exit","_result","skip","replaceContent","incomingDocument","DOMParser","parseFromString","title","innerText","currentEl","incomingEl","replaceWith","scrollToContent","behavior","scrolled","anchor","scrollIntoView","scrollTo","top","left","requestedUrl","isSameResolvedUrl","use","plugin","maybeInvalidPlugin","isSwupPlugin","_checkRequirements","_beforeMount","mount","plugins","unuse","pluginOrName","findPlugin","unmount","_afterUnmount","p","find","url1","url2","defaults","animateHistoryBrowsing","ignoreVisit","linkSelector","Accept","version","clickDelegate","log","handleLinkClick","handlePopState","checkRequirements","enable","origin","triggerWillOpenNewWindow","metaKey","ctrlKey","shiftKey","altKey","button","preventDefault","triggerEl","matches"],"mappings":"uNACO,MAAMA,EAAWA,CAACC,EAAcC,IACvBC,OAAOF,GACpBG,cAGAC,QAAQ,YAAa,KACrBA,QAAQ,WAAY,IACpBA,QAAQ,OAAQ,KAChBA,QAAQ,WAAY,KACLH,GAAY,GCTjBI,EAAgB,SAAAC,GAAC,IAAAC,KAAEA,QAA6B,IAAzBD,EAAyB,CAAE,EAAAA,EAC9D,OAAOE,SAASC,SAAWD,SAASE,QAAUH,EAAOC,SAASD,KAAO,GACtE,ECAaI,EAAsB,SAClCC,EACAC,QAAA,IAAAA,IAAAA,EAAsC,CAAA,GAGtC,MAAMC,EAAO,CACZF,IAFDA,EAAMA,GAAOP,EAAc,CAAEE,MAAM,IAGlCQ,OAAQC,KAAKD,SACbE,OAAQ,UACLJ,GAEJK,QAAQC,UAAUL,EAAM,GAAIF,EAC7B,ECZaQ,EAAsB,SAClCR,EACAC,QADAD,IAAAA,IAAAA,EAAqB,WACrB,IAAAC,IAAAA,EAAsC,CAAE,GAExCD,EAAMA,GAAOP,EAAc,CAAEE,MAAM,IACnC,MAAMO,EAAO,IACTI,QAAQG,MACXT,MACAG,OAAQC,KAAKD,SACbE,OAAQ,UACLJ,GAEJK,QAAQI,aAAaR,EAAM,GAAIF,EAChC,ECfMW,EAAS,IAAIC,QACnB,SAASC,EAAWC,EAAQC,EAAaC,EAAUC,GAC/C,IAAKH,IAAWH,EAAOO,IAAIH,GACvB,OAAO,EAEX,MAAMI,EAAaR,EAAOS,IAAIL,IACvB,IAAIH,QACXD,EAAOU,IAAIN,EAAaI,GACxB,MAAMG,EAASH,EAAWC,IAAIJ,IAAa,IAAIO,IAC/CJ,EAAWE,IAAIL,EAAUM,GACzB,MAAME,EAAUF,EAAOJ,IAAID,GAO3B,OANIH,EACAQ,EAAOG,IAAIR,GAGXK,EAAOI,OAAOT,GAEXO,GAAWV,CACtB,CCXa,MAAAa,EAAgBA,CAK5BC,EACAC,EACAb,EACAc,KAEA,MAAMC,EAAa,IAAIC,gBAGvB,ODaD,SAAkBJ,EAAUC,EAAMb,EAAUc,EAAU,CAAA,GAClD,MAAMG,OAAEA,EAAMC,KAAEA,EAAOC,UAAaL,EACpC,GAAIG,GAAQG,QACR,OAGJ,MAAMC,KAAEA,KAASC,GAA0BR,EAErCf,EAAcmB,aAAgBK,SAAWL,EAAKM,gBAAkBN,EAEhEO,EAAUC,QAA2B,iBAAZZ,EAAuBA,EAAQW,QAAUX,GAClEa,EAAcC,IAChB,MAAMC,EA1Bd,SAAqBD,EAAOhB,GACxB,IAAIkB,EAASF,EAAME,OAInB,GAHIA,aAAkBC,OAClBD,EAASA,EAAOE,eAEhBF,aAAkBG,SAAWL,EAAMM,yBAAyBD,QAAS,CAErE,MAAME,EAAUL,EAAOK,QAAQvB,GAC/B,GAAIuB,GAAWP,EAAMM,cAAcE,SAASD,GACxC,OAAOA,CAEd,CACL,CAc+BE,CAAYT,EAAOhB,GAC1C,GAAIiB,EAAgB,CAChB,MAAMlB,EAAgB2B,OAAOC,OAAOX,EAAO,CAAEC,mBAC7C7B,EAASwC,KAAKzC,EAAaY,GACvBU,IACAtB,EAAY0C,oBAAoB5B,EAAMc,EAAYL,GAClDzB,GAAW,EAAOE,EAAaC,EAAUC,GAEhD,GAECA,EAAQyC,KAAKC,UAAU,CAAE/B,WAAUC,OAAMY,YACpB5B,GAAW,EAAME,EAAaC,EAAUC,IAE/DF,EAAY6C,iBAAiB/B,EAAMc,EAAYL,GAEnDL,GAAQ2B,iBAAiB,QAAS,KAC9B/C,GAAW,EAAOE,EAAaC,EAAUC,EAAM,EAEvD,CC5CC4C,CAAqCjC,EAAUC,EAAMb,EADrDc,EAAU,IAAKA,EAASG,OAAQF,EAAWE,SAEpC,CAAE6B,QAASA,IAAM/B,EAAWgC,QAAO,EChBrC,MAAOC,UAAiBC,IAC7BC,WAAAA,CAAYlE,EAAmBkC,QAAe,IAAfA,IAAAA,EAAeC,SAASgC,SACtDC,MAAMpE,EAAIqE,WAAYnC,EACvB,CAKA,OAAIlC,GACH,OAAOsE,KAAKzE,SAAWyE,KAAKxE,MAC7B,CAOA,kBAAOyE,CAAYC,GAClB,MAAMC,EAAOD,EAAGE,aAAa,SAAWF,EAAGE,aAAa,eAAiB,GACzE,WAAWV,EAASS,EACrB,CAOA,cAAOE,CAAQ3E,GACd,OAAO,IAAIgE,EAAShE,EACrB,QCzBY4E,EAOZV,WAAAA,CAAYW,QALFA,UAAI,EAAAP,KAGJQ,MAAgC,IAAIC,IAG7CT,KAAKO,KAAOA,CACb,CAGA,QAAIG,GACH,YAAYF,MAAME,IACnB,CAGA,OAAIC,GACH,MAAMC,EAAO,IAAIH,IAIjB,OAHAT,KAAKQ,MAAMK,QAAQ,CAACC,EAAMC,KACzBH,EAAK7D,IAAIgE,EAAK,IAAKD,GACpB,GACOF,CACR,CAGAhE,GAAAA,CAAIlB,GACH,YAAY8E,MAAM5D,IAAIoD,KAAKgB,QAAQtF,GACpC,CAGAoB,GAAAA,CAAIpB,GACH,MAAMuF,EAASjB,KAAKQ,MAAM1D,IAAIkD,KAAKgB,QAAQtF,IAC3C,OAAKuF,EACE,IAAKA,GADQA,CAErB,CAGAlE,GAAAA,CAAIrB,EAAaoF,GAChBpF,EAAMsE,KAAKgB,QAAQtF,GACnBoF,EAAO,IAAKA,EAAMpF,OAClBsE,KAAKQ,MAAMzD,IAAIrB,EAAKoF,GACpBd,KAAKO,KAAKW,MAAMC,SAAS,YAAa,CAAEL,QACzC,CAGAM,MAAAA,CAAO1F,EAAa2F,GACnB3F,EAAMsE,KAAKgB,QAAQtF,GACnB,MAAMoF,EAAO,IAAKd,KAAKlD,IAAIpB,MAAS2F,EAAS3F,OAC7CsE,KAAKQ,MAAMzD,IAAIrB,EAAKoF,EACrB,CAGA1D,OAAO1B,GACNsE,KAAKQ,MAAMpD,OAAO4C,KAAKgB,QAAQtF,GAChC,CAGA4F,KAAAA,GACCtB,KAAKQ,MAAMc,QACXtB,KAAKO,KAAKW,MAAMC,SAAS,cAC1B,CAGAI,KAAAA,CAAMC,GACLxB,KAAKQ,MAAMK,QAAQ,CAACC,EAAMpF,KACrB8F,EAAU9F,EAAKoF,IAClBd,KAAK5C,OAAO1B,EACZ,EAEH,CAGUsF,OAAAA,CAAQS,GACjB,MAAM/F,IAAEA,GAAQgE,EAASW,QAAQoB,GACjC,OAAOzB,KAAKO,KAAKmB,WAAWhG,EAC7B,ECpFY,MAAAiG,EAAQ,SAACrE,EAAkBsE,GACvC,gBADuCA,IAAAA,EAA8B/D,UAC9D+D,EAAQC,cAA2BvE,EAC3C,EAGawE,EAAW,SACvBxE,EACAsE,GAEA,YAFA,IAAAA,IAAAA,EAA8B/D,UAEvBkE,MAAMC,KAAKJ,EAAQK,iBAAiB3E,GAC5C,EAGa4E,EAAWA,IAChB,IAAIC,QAASnB,IACnBoB,sBAAsB,KACrBA,sBAAsB,KACrBpB,GAAO,EACP,EACD,GAKa,SAAAqB,EAAaC,GAC5B,QACGA,IACc,iBAARA,GAAmC,mBAARA,IACf,mBAAbA,EAAIC,IAEb,CAyBO,MAAMC,EAAuBC,GAE/BC,OAAOC,KAAOD,OAAOC,IAAIC,OACrBD,IAAIC,OAAOH,GAEZA,EAIKI,EAAQC,GAC8B,IAA3CC,OAAOD,EAAEE,MAAM,GAAI,GAAG9H,QAAQ,IAAK,YC/D9B+H,EAIZrD,WAAAA,CAAYW,GAAUP,KAHZO,UAAI,EAAAP,KACJkD,YAAc,CAAC,MAAO,cAAe,eAAgB,cAAe,gBAG7ElD,KAAKO,KAAOA,CACb,CAEA,aAAc4C,GACb,MAAMC,MAAEA,GAAUpD,KAAKO,KAAK8C,MAAMC,UAClC,MAAc,eAAVF,EAA+BpD,KAAKO,KAAK8C,MAAME,WACrC,SAAVH,EAAyB,CAAC,QAC1BrB,MAAMyB,QAAQJ,GAAeA,EAC1B,EACR,CAEA,YAAc9F,GACb,OAAO0C,KAAKmD,UAAUM,KAAK,IAC5B,CAEA,WAAcC,GACb,OAAK1D,KAAK1C,SAASqG,OACZ7B,EAAS9B,KAAK1C,UADa,EAEnC,CAEAH,GAAAA,GACC6C,KAAK0D,QAAQ7C,QAASrC,GAAWA,EAAOoF,UAAUzG,OAAI6F,GAAAA,MAAA9D,KAAA2E,YACvD,CAEAC,MAAAA,GACC9D,KAAK0D,QAAQ7C,QAASrC,GAAWA,EAAOoF,UAAUE,UAAOd,GAAAA,MAAA9D,KAAA2E,YAC1D,CAEAvC,KAAAA,GACCtB,KAAK0D,QAAQ7C,QAASrC,IACrB,MAAMsF,EAAStF,EAAOuF,UAAUC,MAAM,KAAKC,OAAQC,GAAMlE,KAAKmE,YAAYD,IAC1E1F,EAAOoF,UAAUE,UAAUA,EAC5B,EACD,CAEUK,WAAAA,CAAYJ,GACrB,OAAW/D,KAACkD,YAAYkB,KAAMF,GAAMH,EAAUM,WAAWH,GAC1D,ECsCe,SAAAI,EAAWC,GAE1B,IAAAC,GACCA,EAAExC,KACFA,EAAOhC,KAAKyE,eACZpJ,KAAMmD,EAAMkG,QACZA,GAAU,EACVpB,UAAWqB,EAAIzE,GACfA,EAAE5B,MACFA,EAAKsG,OACLA,EAAS,OACTC,YAAaC,GAAQ,GACHP,EAEnB,MAAO,CACNvC,KAAM,CAAEtG,IAAKsG,GACbwC,GAAI,CAAE9I,IAAK8I,GACXjB,WAAYvD,KAAKxC,QAAQ+F,WACzBD,UAAW,CACVoB,UACAK,MAAM,EACNJ,OACAvB,MAAOpD,KAAKxC,QAAQwH,eACpB1H,SAAU0C,KAAKxC,QAAQyH,mBAExBC,QAAS,CACRhF,KACA5B,SAEDtC,QAAS,CACR4I,SACAO,UAAU,EACVC,eAAWC,GAEZC,OAAQ,CACPR,QACAtG,UAGH,yHCCe+G,EAAApJ,EAAAqJ,SACF1C,EAAA,IACV0C,aAAAC,EAAA,CAEF,IAAAD,EAAA1C,EAQU,YADP0C,EAAAE,EAAAC,EAAAC,KAAA,KAAAL,EAAApJ,IANG,EAALA,MACKqJ,EAAM1C,GAGZ0C,EAAAA,EAAAK,EAOA,GAAAL,GAAAA,EAAAjD,KAEG,0DAEEpG,QAEH,MAAA2J,EAAAP,EAAAG,EACDI,GAEDA,EAAAP,EAEG,CACH,CApED,MAAAE,eAAA,sFAKG,GAAAtJ,EAAA,CACH,QAAkB,EAAAA,EAAA4J,EAAAC,KAC4BtJ,EAAA,CACnC,IAEiCiJ,EAAA1E,EAAA,EAAAvE,EAAAsD,KAAA6F,GACjC,CAAA,MAAyBI,GAEwDN,EAAA1E,EAAA,EAAAgF,EAC3F,CACmB,OAAoBhF,4BAKlB,SAAAiF,aAEJV,EAAAU,EAAAL,EACH,EAAbK,EAAapD,IACF7B,EAAA,EAAA8E,EAAAA,EAAAP,GAAAA,GACMQ,IACD/E,EAAA,EAAA+E,EAAAR,MAEPvE,EAAA,EAAAuE,SAEIS,KACKhF,EAAA,EAAAgF,KAGLhF,KAlCf,GAsEE,SAAAkF,EAAAC,GAED,OAAAA,aAAAX,GAAA,EAAAW,EAAAtD,EAlEY,MAAAuD,EAsCZzG,WAAAA,CAAYW,GApCFA,KAAAA,UAGA+F,EAAAA,KAAAA,SAAyB,IAAI7F,IAIpBS,KAAAA,MAAoB,CACtC,sBACA,sBACA,oBACA,qBACA,qBACA,mBACA,iBACA,cACA,YACA,kBACA,iBACA,SACA,UACA,gBACA,cACA,mBACA,aACA,YACA,cACA,cACA,YACA,YACA,aACA,gBACA,cACA,aAIAlB,KAAKO,KAAOA,EACZP,KAAKuG,MACN,CAKUA,IAAAA,GACTvG,KAAKkB,MAAML,QAAS2F,GAASxG,KAAKyG,OAAOD,GAC1C,CAKAC,MAAAA,CAAOD,GACDxG,KAAKsG,SAAS1J,IAAI4J,IACtBxG,KAAKsG,SAASvJ,IAAIyJ,EAAkB,IAAI/F,IAE1C,CAKAiG,MAAAA,CAAOF,GACN,OAAWxG,KAACsG,SAAS1J,IAAI4J,EAC1B,CAKU1J,GAAAA,CAAwB0J,GACjC,MAAMnK,EAAS2D,KAAKsG,SAASxJ,IAAI0J,GACjC,GAAInK,EACH,OAAOA,EAERsK,QAAQC,uBAAuBJ,KAChC,CAKAlF,KAAAA,GACCtB,KAAKsG,SAASzF,QAASxE,GAAWA,EAAOiF,QAC1C,CAgBAuF,EAAAA,CACCL,EACAM,EACAtJ,YAAAA,IAAAA,EAAuB,CAAE,GAEzB,MAAMnB,EAAS2D,KAAKlD,IAAI0J,GACxB,IAAKnK,EAEJ,OADAsK,QAAQI,cAAcP,iBACf,OAGR,MAAMQ,EAAK3K,EAAOqE,KAAO,EACnBuG,EAAoC,IAAKzJ,EAASwJ,KAAIR,OAAMM,WAGlE,OAFAzK,EAAOU,IAAI+J,EAASG,GAEb,IAAMjH,KAAKkH,IAAIV,EAAMM,EAC7B,CAaAK,MAAAA,CACCX,EACAM,EACAtJ,GAEA,gBAFAA,IAAAA,EAAuB,CAAE,GAEdwC,KAAC6G,GAAGL,EAAMM,EAAS,IAAKtJ,EAAS2J,QAAQ,GACrD,CAaAjM,OAAAA,CACCsL,EACAM,EACAtJ,GAEA,gBAFAA,IAAAA,EAAuB,CAAE,GAEdwC,KAAC6G,GAAGL,EAAMM,EAAS,IAAKtJ,EAAStC,SAAS,GACtD,CAYA6C,IAAAA,CACCyI,EACAM,EACAtJ,GAEA,gBAFAA,IAAAA,EAAuB,CAAE,GAEdwC,KAAC6G,GAAGL,EAAMM,EAAS,IAAKtJ,EAASO,MAAM,GACnD,CAUAmJ,GAAAA,CAAwBV,EAASM,GAChC,MAAMzK,EAAS2D,KAAKlD,IAAI0J,GACpBnK,GAAUyK,EACGzK,EAAOe,OAAO0J,IAE7BH,QAAQI,0BAA0BP,iBAEzBnK,GACVA,EAAOiF,OAET,CAUMpC,IAAAA,CACLsH,EACAY,EACAC,GAA2B,IAAA,MAAAnB,EAEQlG,MAA7BmH,OAAEA,EAAML,QAAEA,EAAOQ,MAAEA,GAAUpB,EAAKqB,YAAYf,EAAMa,GAAgB,OAAAlF,QAAAnB,QACpEkF,EAAKsB,IAAIL,EAAQC,IAAK7E,KAAAJ,WAAAA,OAAAA,QAAAnB,QACLkF,EAAKsB,IAAIV,EAASM,IAAK7E,KAAAgC,SAAAA,GAAxC,IAACtD,GAAOsD,EAAApC,OAAAA,QAAAnB,QACRkF,EAAKsB,IAAIF,EAAOF,IAAK7E,KAAA,WAE3B,OADA2D,EAAKuB,iBAAiBjB,EAAMY,GACrBnG,CAAO,EAAA,EAAA,EACf,CAAC,MAAAgF,GAAA,OAAA9D,QAAAuF,OAAAzB,EAAA,CAAA,CAUD9E,QAAAA,CACCqF,EACAY,EACAC,GAEA,MAAMF,OAAEA,EAAML,QAAEA,EAAOQ,MAAEA,GAAUtH,KAAKuH,YAAYf,EAAMa,GAC1DrH,KAAK2H,QAAQR,EAAQC,GACrB,MAAOnG,GAAUjB,KAAK2H,QAAQb,EAASM,GAGvC,OAFApH,KAAK2H,QAAQL,EAAOF,GACpBpH,KAAKyH,iBAAiBjB,EAAMY,GACrBnG,CACR,CAOgBuG,GAAAA,CACfI,EACAR,GAAuB,IAAAS,MAAAA,EAIsB7H,KAFvC8H,EAAU,GAAG1M,WAoBHoD,EAAGuJ,EAAAC,GACnB,GAA0C,mBAA1CxJ,EAAWyJ,GAAiC,CAC3C,IAAgCC,EAAM3C,EAA0BmC,EAAhES,EAAA3J,EAAYyJ,KA4Bb,GA3BC,SAAAG,EAAAnH,GACA,IACC,OAAAiH,EAAAC,EACCE,QAAAC,MAGD,IAFErH,EAAA8G,EAAAG,EAAA1C,SAEFvE,EAAAsB,KAAA,CACD,IAAA4D,EAAUlF,GAIX,YADCA,EAAAsB,KAAA6F,EAAAV,IAAAA,EAAA/B,EAAAC,KAAA,KAAAL,EAAA,IAAAE,EAAA,KAFCxE,EAAAA,EAAQ4E,CAMX,gBAOqB,MAAAI,KACdV,MAAc,IAAAE,GAAU,EAAAQ,IAG7BmC,GAEDD,EAAUI,OAAO,OACX,SAAA/C,OAGA0C,EAAAI,QACAC,QAEN,CAAA,MAAAtC,WAGiET,GAEjE,GAAAD,UACC,OAAAA,EAAAhD,KAAUiG,EAAO,SAASvC,GAC1B,MAAAuC,IACC,GAEAA,IAEC,OAAAjD,EAGO,KAAA,WAAA/G,GACN,MAAA,IAAAiK,UAAA,0BAIF,IADA,IAAAC,EAAA,GACAC,EAAA,EAAAA,EAAAnK,EAAUoK,OAAAD,IACTD,EAAAG,KAAArK,EAAAmK,IAED,OAnIH,SAAAG,EAAAf,EAAAC,gBAkCC,iEA3BE,IAAA7B,EAAAlF,GAQF,cADMsB,KAAI6F,MAAmBV,EAAA/B,EAAAC,KAAA,KAAAL,EAAA,IAAAE,EAAA,KAN9BxE,EACCA,EACA4E,CAOA,CAEAN,EAEDI,EAAAJ,EAAA,EAAAtE,oCAOG,CACHmH,GAKC7C,CACA,CAgGEwD,CAAAL,EAAA,SAAAC,GAAA,OAAAZ,EAAAW,EAAAC,GAAA,EACD,CAjFkBK,CACmCpB,EAAaqB,SAAAA,GAAE,IAA1DzC,KAAEA,EAAIM,QAAEA,EAAOO,eAAEA,EAActJ,KAAEA,GAAMkL,EAAA,OAAA9G,QAAAnB,QH3SpC,SAAakI,EAAgB9B,GAC5C,gBAD4CA,IAAAA,EAAc,IACnD,IAAIjF,QAAQ,CAACnB,EAAS0G,KAC5B,MAAMzG,EAASiI,KAAQ9B,GACnB/E,EAAUpB,GACbA,EAAOsB,KAAKvB,EAAS0G,GAErB1G,EAAQC,EACR,EAEH,CGmSwBkI,CAAarC,EAAS,CAACe,EAAKtH,KAAK8C,MAAO+D,EAAMC,KAAgB9E,KAAA,SAA7EtB,GACN6G,EAAQe,KAAK5H,GACTlD,GACH8J,EAAKX,IAAIV,EAAMM,EAAS,EAEzB,GAAA,OAAA3E,QAAAnB,QAAA5F,GAAAA,EAAAmH,KAAAnH,EAAAmH,KAAA,WACD,OAAOuF,CAAQ,GAARA,EACR,CAAC,MAAA7B,GAAA9D,OAAAA,QAAAuF,OAAAzB,EAOS0B,CAAAA,CAAAA,OAAAA,CACTC,EACAR,GAEA,MAAMU,EAAU,GAChB,IAAK,MAAMtB,KAAEA,EAAIM,QAAEA,EAAOO,eAAEA,EAActJ,KAAEA,KAAU6J,EAAe,CACpE,MAAM3G,EAAS6F,EAAQ9G,KAAKO,KAAK8C,MAAO+D,EAA0BC,GAClES,EAAQe,KAAK5H,GACToB,EAAUpB,IACb0F,QAAQI,KACP,uDAAuDP,4CAIrDzI,GACHiC,KAAKkH,IAAIV,EAAMM,EAEhB,CACD,OAAOgB,CACR,CASUP,WAAAA,CAAgCf,EAASa,GAClD,MAAMhL,EAAS2D,KAAKlD,IAAI0J,GACxB,IAAKnK,EACJ,MAAO,CAAE+M,OAAO,EAAOjC,OAAQ,GAAIL,QAAS,GAAIQ,MAAO,GAAI+B,UAAU,GAGtE,MAAMC,EAAOtJ,KAAKuJ,kBACZ3B,EAAgB7F,MAAMC,KAAK3F,EAAOqM,UAGlCvB,EAASS,EAAc3D,OAAOuF,IAAA,IAACrC,OAAEA,EAAMjM,QAAEA,GAASsO,EAAA,OAAKrC,IAAWjM,IAASoO,KAAKA,GAChFpO,EAAU0M,EAAc3D,OAAOwF,IAAC,IAAAvO,QAAEA,GAASuO,EAAK,OAAAvO,IAASoO,KAAKA,GAC9DhC,EAAQM,EAAc3D,OAAOyF,IAAA,IAACvC,OAAEA,EAAMjM,QAAEA,GAASwO,EAAK,OAACvC,IAAWjM,IAASoO,KAAKA,GAChFD,EAAWnO,EAAQ0N,OAAS,EAIlC,IAAI9B,EAAiC,GACrC,GAAIO,IACHP,EAAU,CAAC,CAAEE,GAAI,EAAGR,OAAMM,QAASO,IAC/BgC,GAAU,CACb,MAAMM,EAAQzO,EAAQ0N,OAAS,EAEzBgB,EAAwBD,IAC7B,MAAMtB,EAAOnN,EAAQyO,EAAQ,GAC7B,OAAItB,EACI,CAAChF,EAAO+D,IACdiB,EAAKvB,QAAQzD,EAAO+D,EAAMwC,EAAqBD,EAAQ,IAEjDtC,CACP,EAGFP,EAAU,CACT,CAAEE,GAAI,EAAGR,OAAMM,QAZS5L,EAAQyO,GAAO7C,QAYGO,eAFduC,EAAqBD,IAIlD,CAGF,MAAO,CAAEP,OAAO,EAAMjC,SAAQL,UAASQ,QAAO+B,WAC/C,CAQUE,iBAAAA,CACTM,EACAC,GAIA,OAFkBD,EAAEE,UAAY,IAAMD,EAAEC,UAAY,IACzCF,EAAE7C,GAAK8C,EAAE9C,IACK,CAC1B,CAMUS,gBAAAA,CAAqCjB,EAASY,GAEvDvJ,SAASmM,cAAc,IAAIC,YAAY,QAAQzD,IAAQ,CAAE0D,OAD1C,CAAE1D,OAAMY,OAAM/D,MAAOrD,KAAKO,KAAK8C,SAE/C,EC9aY,MAAA8G,EAAoB9O,IAKhC,GAJIA,GAA2B,MAAnBA,EAAK+O,OAAO,KACvB/O,EAAOA,EAAKgP,UAAU,KAGlBhP,EACJ,OAAO,KAGR,MAAMiP,EAAUC,mBAAmBlP,GACnC,IAAImP,EACH3M,SAAS4M,eAAepP,IACxBwC,SAAS4M,eAAeH,IACxB3I,EAAiB,WAAAiB,EAAOvH,SACxBsG,aAAiBiB,EAAO0H,QAMzB,OAJKE,GAAoB,QAATnP,IACfmP,EAAU3M,SAASkK,MAGbyC,GCbcE,EAAeA,SAAAnG,GAEpC,IAAAoG,SACCA,EAAQrN,SACRA,GAIAiH,EAAA,IAGD,IAAiB,IAAbjH,IAAuBqN,EAC1B,OAAAxI,QAAAnB,UAID,IAAI4J,EAAkC,GACtC,GAAID,EACHC,EAAmB7I,MAAMC,KAAK2I,QACxB,GAAIrN,IACVsN,EAAmB9I,EAASxE,EAAUO,SAASkK,OAE1C6C,EAAiBhC,QAErB,OADAjC,QAAQI,8DAA8DzJ,OACtE6E,QAAAnB,UAIF,MAAM6J,EAAoBD,EAAiBE,IAAK5K,GAcjD,SAAkCsK,GACjC,MAAMjN,KAAEA,EAAIwN,QAAEA,EAAOC,UAAEA,YAiDUR,EAAkBS,GACnD,MAAMC,EAASxI,OAAOyI,iBAAiBX,GAEjCY,EAAmBC,EAAmBH,EAAW,GAAAI,UACjDC,EAAsBF,EAAmBH,EAAW,GAAAI,aACpDE,EAAoBC,EAAiBL,EAAkBG,GACvDG,EAAkBL,EAAmBH,EAAW,GAAAS,UAChDC,EAAqBP,EAAmBH,EAAW,GAAAS,aACnDE,EAAmBJ,EAAiBC,EAAiBE,GAE3D,IAAIrO,EAA8B,KAC9BwN,EAAU,EACVC,EAAY,EAwBhB,OAtBIC,IAAiBK,EAChBE,EAAoB,IACvBjO,EAAO+N,EACPP,EAAUS,EACVR,EAAYO,EAAoB3C,QAEvBqC,IAAiBU,EACvBE,EAAmB,IACtBtO,EAAOoO,EACPZ,EAAUc,EACVb,EAAYY,EAAmBhD,SAGhCmC,EAAUjP,KAAKgQ,IAAIN,EAAmBK,GACtCtO,EAAOwN,EAAU,EAAKS,EAAoBK,EAAmBP,EAAaK,EAAa,KACvFX,EAAYzN,EACTA,IAAS+N,EACRC,EAAoB3C,OACpBgD,EAAmBhD,OACpB,GAGG,CACNrL,OACAwN,UACAC,YAEF,CA1FsCe,CAAkBvB,GAGvD,SAAKjN,IAASwN,IAIP,IAAI5I,QAASnB,IACnB,MAAMgL,EAAc,GAAAzO,OACd0O,EAAYC,YAAYC,MAC9B,IAAIC,EAAoB,EAExB,MAAMC,EAAMA,KACX7B,EAAQrL,oBAAoB6M,EAAUM,GACtCtL,GAAO,EAGFsL,EAAwBhO,IAE7B,GAAIA,EAAME,SAAWgM,EAArB,CAIA,IAqEH,SAAsClM,GACrC,MAAO,CAAI,GAAAgN,UAAoBK,QAAgBY,SAASjO,EAAMf,KAC/D,CAvEQiP,CAA6BlO,GACjC,UAAUmO,MAAM,yCAIIP,YAAYC,MAAQF,GAAa,IACpC3N,EAAMoO,eAKlBN,GAAqBpB,GAC1BqB,GAdA,CAeA,EAGFM,WAAW,KACNP,EAAoBpB,GACvBqB,GACA,EACCtB,EAAU,GAEbP,EAAQlL,iBAAiB0M,EAAUM,EAAK,EAE1C,CA9DwDM,CAAyB1M,IAEhF,OADsB2K,EAAkB5G,OAAO7F,SAASwK,OAAS,EAQhEzG,QAAAnB,QAEKmB,QAAQxB,IAAIkK,IAAkBtI,KACrC,WAAA,IATMjF,GACHqJ,QAAQI,wEAC4DzJ,OAGrE6E,QAAAnB,UAIF,CAAC,MAAAiF,GAAA,OAAA9D,QAAAuF,OAAAzB,EAAA,CAAA,EAtDKqF,EAAa,aACbK,EAAY,YAwJlB,SAASN,EAAmBH,EAAoCnK,GAC/D,OAAQmK,EAAOnK,IAAQ,IAAIiD,MAAM,KAClC,CAEA,SAASyH,EAAiBoB,EAAkBC,GAC3C,KAAOD,EAAOjE,OAASkE,EAAUlE,QAChCiE,EAASA,EAAOE,OAAOF,GAGxB,OAAO/Q,KAAKgQ,OAAOgB,EAAUhC,IAAI,CAACkC,EAAUrE,IAAM9F,EAAKmK,GAAYnK,EAAKgK,EAAOlE,KAChF,CClHsB,MAAAsE,EAAiBA,SAEtCvR,EACA8B,YAAAA,IAAAA,EAA4C,IAAE,IAAA,MAAA0I,EAM/BlG,KAJf,GAAmB,iBAARtE,EACV,MAAU,IAAA+Q,MAAM,4CAGjB,MAAMvM,GAAEA,GAAOgG,EAAK7C,MAAM6B,QAC1BgB,EAAK7C,MAAMmB,GAAG9I,IAAMgE,EAASW,QAAQ3E,GAAKA,IAC1C8B,EAAQ0P,SAAW1P,EAAQ0P,UAAYhH,EAAKzB,gBAEpB,IAApBjH,EAAQkH,UACXwB,EAAK7C,MAAMC,UAAUoB,SAAU,GAI3BwB,EAAK7C,MAAMC,UAAUoB,SACzBwB,EAAKiH,QAAQ7L,QAId,MAAMtF,EAAUwB,EAAQxB,SAAWkE,GAAIE,aAAa,2BAAwBiF,EACxErJ,GAAW,CAAC,OAAQ,WAAWuQ,SAASvQ,KAC3CkK,EAAK7C,MAAMrH,QAAQ4I,OAAS5I,GAI7B,MAAMsH,EAAY9F,EAAQ8F,WAAapD,GAAIE,aAAa,6BAA0BiF,EAGjF,OAFG/B,IACH4C,EAAK7C,MAAMC,UAAUqB,KAAOrB,GAC5BnB,QAAAnB,gCAEGmB,QAAAnB,QACGkF,EAAKhF,MAAMhC,KAAK,gBAAcqD,KAAA,WAAA,SAAA6K,IA8BpC,MAAMC,EAAmBnH,EAAKoH,iBAAiB,OAAAnL,QAAAnB,QAC1BmB,QAAQxB,IAAI,CAAC4M,EAAaF,KAAkB9K,KAAA,SAAAgC,GAA3D,IAACzD,GAAKyD,EAAApC,OAAAA,QAAAnB,QAGNkF,EAAKsH,WAAWtH,EAAK7C,MAAMmB,GAAG9I,IAAKoF,IAAKyB,KAAAJ,WAAAA,OAAAA,QAAAnB,QAGxCkF,EAAKuH,iBAAelL,KAAAJ,WAAAA,OAAAA,QAAAnB,QAGpBkF,EAAKhF,MAAMhC,KAAK,iBAAamG,EAAW,IAAMa,EAAKiH,QAAQ7L,UAAQiB,yBArCzE,MAAMgL,EAAcrH,EAAKhF,MAAMhC,KAAK,YAAa,CAAE1B,oBAAkB6F,EAAO+D,GAAQ,IAAA,SAAAsG,EAAAC,GAInF,OAFAvG,EAAKtG,KAAI6M,EACTvG,EAAKwG,QAAUC,EACRzG,EAAKtG,IAAK,CAHjB,MAAM+M,EAAa3H,EAAK0H,MAAM9Q,IAAIuG,EAAMmB,GAAG9I,KAAM,OAAAyG,QAAAnB,QACrC6M,EAAUH,EAAVG,GAAU1L,QAAAnB,QAAWkF,EAAK4H,UAAUzK,EAAMmB,GAAG9I,IAAM0L,EAAK5J,UAAQ+E,KAAAmL,GAG7E,CAAC,MAAAzH,GAAA,OAAA9D,QAAAuF,OAAAzB,EAAA,CAAA,GAGD,IAAKC,EAAK7C,MAAMrH,QAAQmJ,SAAU,CACjC,MAAM4I,EAASrS,GAAOwK,EAAK7C,MAAMiC,OAAO9G,QAAU,IAChB,YAA9B0H,EAAK7C,MAAMrH,QAAQ4I,OACtB1I,EAAoB6R,GAGpBtS,EAAoBsS,EAAQ,CAAEpE,MADhBzD,EAAK8H,oBAAsB,GAG1C,CAED9H,EAAKzB,eAAiBtJ,IAAgB,MAAAC,gBAGlC8K,EAAK7C,MAAMC,UAAUyB,KAAI,OAAA5C,QAAAnB,QACLuM,GAAWhL,KAAA0G,SAAAA,OAA5BgF,KAAEA,GAAMhF,EACd/C,EAAK7C,MAAMmB,GAAGyJ,KAAOA,CAAK,aAAA7S,GAAAA,EAAAmH,KAAAnH,EAAAmH,KAAA6K,GAAAA,GAoB3B,4DAjDAc,CAEG,WA+CKtH,GAEHA,IAKLD,QAAQC,MAAMA,GAGdV,EAAK1I,QAAQ2Q,qBAAuB,KACnCzL,OAAOpH,SAAS6E,KAAO+F,EAAK7C,MAAMmB,GAAG9I,KAC9B,GAIRgH,OAAO1G,QAAQoS,IAAI,GACnB,GACF,CAAC,MAAAnI,GAAA9D,OAAAA,QAAAuF,OAAAzB,EA/HD,CAAA,EAAgB,SAAAoI,EAEf3S,EACA8B,EACA+I,GAGA,QAJ4C,IAA5C/I,IAAAA,EAA4C,CAAA,YAC5C+I,IAAAA,EAAqC,IAGjCvG,KAAKsO,kBAAkB5S,EAAK,CAAEwE,GAAIqG,EAAKrG,GAAI5B,MAAOiI,EAAKjI,QAE1D,YADAoE,OAAOpH,SAAS6E,KAAOzE,GAIxB,MAAQA,IAAK8I,EAAEnJ,KAAEA,GAASqE,EAASW,QAAQ3E,GAC3CsE,KAAKqD,MAAQrD,KAAKsE,YAAY,IAAKiC,EAAM/B,KAAInJ,SAC7C2E,KAAKiN,kBAAkBzI,EAAIhH,EAC5B,OCJsBsQ,EAASA,SAE9BpS,EACA8B,YAAAA,IAAAA,EAAwB,CAAA,GAAE,IAAA,MAAA0I,EAILlG,KAFrBtE,EAAMgE,EAASW,QAAQ3E,GAAKA,IAE5B,MAAM6S,EAAU,IAAKrI,EAAK1I,QAAQgR,kBAAmBhR,EAAQ+Q,SAC3B,OAAlC/Q,EAAU,IAAKA,EAAS+Q,WAAUpM,QAAAnB,QAGDkF,EAAKhF,MAAMhC,KAC3C,gBACA,CAAExD,MAAK8B,WACP,CAAC6F,EAAKkB,SAAE7I,IAAEA,EAAG8B,QAAEA,GAAS+G,EAAK,OAAAkK,MAAM/S,EAAK8B,EAAO,IAC/C+E,cAJKmM,GAMN,MAAMC,OAAEA,EAAQjT,IAAKkT,GAAgBF,EAAS,OAAAvM,QAAAnB,QAC3B0N,EAAS5T,QAAMyH,KAAA,SAA5B0L,GAEN,GAAe,MAAXU,EAEH,MADAzI,EAAKhF,MAAMhC,KAAK,cAAe,CAAEyP,SAAQD,WAAUhT,IAAKkT,IAClD,IAAIC,EAAW,iBAAiBD,IAAe,CAAED,SAAQjT,IAAKkT,IAGrE,IAAKX,EACJ,MAAU,IAAAY,EAAW,mBAAmBD,IAAe,CAAED,SAAQjT,IAAKkT,IAIvE,MAAQlT,IAAKoT,GAAapP,EAASW,QAAQuO,GACrC9N,EAAO,CAAEpF,IAAKoT,EAAUb,QAO9B,OAJIvS,IAAQoT,GACX5I,EAAK0H,MAAM7Q,IAAI+D,EAAKpF,IAAKoF,GAGnBA,CAAK,EACb,EAAA,CAAC,MAAAmF,GAAA,OAAA9D,QAAAuF,OAAAzB,EArDD,CAAA,QAAa4I,UAAmBpC,MAG/B7M,WAAAA,CAAYmP,EAAiBC,GAC5BlP,MAAMiP,GAAS/O,KAHhBtE,SAAG,EAAAsE,KACH2O,YAAM,EAGL3O,KAAK2E,KAAO,aACZ3E,KAAKtE,IAAMsT,EAAQtT,IACnBsE,KAAK2O,OAASK,EAAQL,MACvB,ECtBY,MAAArB,EAAc,WAAA,IAAQ2B,IAAAA,EAAA/I,MAAAA,EAC7BlG,KAAIoN,SAAAA,EAAA8B,GAAA,OAAAD,EAAAC,EAAA/M,QAAAnB,QAKHkF,EAAKhF,MAAMhC,KAAK,2BAAuBmG,EAAYhC,IACxD6C,EAAKiH,QAAQhQ,IAAI,cAAe,aAAc,gBAC1CkG,EAAMrH,QAAQmJ,UACjBe,EAAKiH,QAAQhQ,IAAI,eAEdkG,EAAMC,UAAUqB,MACnBuB,EAAKiH,QAAQhQ,UAAUtC,EAASwI,EAAMC,UAAUqB,QAChD,IACApC,KAAA,WAAA,OAAAJ,QAAAnB,QAEIkF,EAAKhF,MAAMhC,KAAK,sBAAuB,CAAEiQ,MAAM,GAAO,SAAS9L,EAAKkB,GAAE,IAAA4K,KAAEA,GAAM5K,EAAI,IACvF,OAAI4K,EAAMhN,QAAAnB,UAAOmB,QAAAnB,QACXkF,EAAKwE,gBAAgB,CAAEpN,SAAU+F,EAAMC,UAAUhG,YAAWiF,KACnE,WAAA,EAAA,CAAC,MAAA0D,GAAA9D,OAAAA,QAAAuF,OAAAzB,EAAC,CAAA,IAAA1D,KAAA,WAAA,OAAAJ,QAAAnB,QAEIkF,EAAKhF,MAAMhC,KAAK,sBAAoBqD,KAAA,WAAA,EAAA,EAAA,EAAA,CAAA,MAAAnH,EAAA,WAAA,IApBrC8K,EAAK7C,MAAMC,UAAUoB,QAAOvC,OAAAA,QAAAnB,QAC1BkF,EAAKhF,MAAMhC,KAAK,mBAAiBqD,KAAA,WAAA0M,EAAA,CAAA,EAAA,CAmBE,GAnBF,OAAA9M,QAAAnB,QAAA5F,GAAAA,EAAAmH,KAAAnH,EAAAmH,KAAA6K,GAAAA,EAAAhS,GAoBzC,CAAC,MAAA6K,GAAA,OAAA9D,QAAAuF,OAAAzB,EAAA,CAAA,EClBYmJ,EAAiB,SAAA7K,EAAAnJ,OAE7B6S,KAAEA,GAAgB1J,GAClBhB,WAAEA,QAAsD,IAAAnI,EAAA4E,KAAKxC,QAAOpC,EAEpE,MAAMiU,GAAmB,IAAIC,WAAYC,gBAAgBtB,EAAM,aAGzDuB,EAAQH,EAAiBxN,cAAc,UAAU4N,WAAa,GAsBpE,OArBA5R,SAAS2R,MAAQA,EAGAjM,EACfuH,IAAKxN,IACL,MAAMoS,EAAY7R,SAASgE,cAAcvE,GACnCqS,EAAaN,EAAiBxN,cAAcvE,GAClD,OAAIoS,GAAaC,GAChBD,EAAUE,YAAYD,QAGlBD,GACJ/I,QAAQI,sDAAsDzJ,KAE1DqS,GACJhJ,QAAQI,uDAAuDzJ,MAEzD,KAEP2G,OAAO7F,SAEOwK,SAAWrF,EAAWqF,MACvC,ECpCaiH,EAAkB,WAC9B,MAAMrS,EAAiC,CAAEsS,SAAU,SAC7CtR,OAAEA,EAAMsG,MAAEA,GAAU9E,KAAKqD,MAAMiC,OACrC,IAAIyK,GAAW,EAuBf,OArBIvR,IACHuR,EAAW/P,KAAKkB,MAAMC,SACrB,gBACA,CAAE9F,KAAMmD,EAAQhB,WAChB,CAAC6F,EAAKkB,KAAuB,IAArBlJ,KAAEA,EAAImC,QAAEA,GAAS+G,EACxB,MAAMyL,EAAShQ,KAAKmK,iBAAiB9O,GAAQ,IAI7C,OAHI2U,GACHA,EAAOC,eAAezS,KAEdwS,KAKRlL,IAAUiL,IACbA,EAAW/P,KAAKkB,MAAMC,SAAS,aAAc,CAAE3D,WAAW,CAAC6F,EAAK4F,SAAEzL,QAAEA,GAASyL,EAE5E,OADAvG,OAAOwN,SAAS,CAAEC,IAAK,EAAGC,KAAM,KAAM5S,UAKjCuS,CACR,EC1BatC,EAAa,WAAA,UAAQvH,EAC5BlG,KAAL,IAAKkG,EAAK7C,MAAMC,UAAUoB,QACzB,OAAAvC,QAAAnB,UAGD,MAAMsC,EAAY4C,EAAKhF,MAAMhC,KAC5B,qBACA,CAAEiQ,MAAM,YACD9L,EAAKkB,GAAA,IAAE4K,KAAEA,GAAM5K,EAAA,IACrB,OAAI4K,EAAMhN,QAAAnB,UAAOmB,QAAAnB,QACXkF,EAAKwE,gBAAgB,CAAEpN,SAAU+F,EAAMC,UAAUhG,YAAWiF,KAAA,WAAA,EACnE,CAAC,MAAA0D,UAAA9D,QAAAuF,OAAAzB,EACD,CAAA,GAAC,OAAA9D,QAAAnB,QAEIkB,KAAUK,KAAA,WAAA,OAAAJ,QAAAnB,QAEVkF,EAAKhF,MAAMhC,KAAK,0BAAsBmG,EAAW,KACtDa,EAAKiH,QAAQrJ,OAAO,eACrB,IAAEvB,KAAAJ,WAAAA,OAAAA,QAAAnB,QAEIsC,GAASf,uBAAAJ,QAAAnB,QAETkF,EAAKhF,MAAMhC,KAAK,qBAAmBqD,KAC1C,WAAA,EAAA,EAAA,EAAA,EAAA,CAAC,MAAA0D,GAAA,OAAA9D,QAAAuF,OAAAzB,EAAA,CAAA,ECtBYuH,EAAU,SAA+B6C,EAAsBvP,GAAc,IAAAoF,MAAAA,EAGzFlG,MAFMtE,IAAEA,EAAGuS,KAAEA,GAASnN,EAKtB,OAHAoF,EAAKiH,QAAQrJ,OAAO,cAGfoC,EAAKoK,kBAAkBnV,IAAiBkV,IAKxCnK,EAAKoK,kBAAkBnV,IAAiBO,KAC5CQ,EAAoBR,GACpBwK,EAAKzB,eAAiBtJ,IACtB+K,EAAK7C,MAAMmB,GAAG9I,IAAMwK,EAAKzB,gBAItByB,EAAK7C,MAAMC,UAAUoB,SACxBwB,EAAKiH,QAAQhQ,IAAI,gBAIlB+I,EAAK7C,MAAMmB,GAAGyJ,KAAOA,EAAK9L,QAAAnB,QAGpBkF,EAAKhF,MAAMhC,KAAK,kBAAmB,CAAE4B,QAAQ,CAACuC,EAAKkB,KAAc,IAAZzD,KAAEA,GAAMyD,EAElE,IADgB2B,EAAKkJ,eAAetO,EAAM,CAAEyC,WAAYF,EAAME,aAE7D,UAAUkJ,MAAM,uCAEbpJ,EAAMC,UAAUoB,UAEnBwB,EAAKiH,QAAQhQ,IAAI,eAAgB,cAAe,gBAC5CkG,EAAMC,UAAUqB,MACnBuB,EAAKiH,QAAQhQ,UAAUtC,EAASwI,EAAMC,UAAUqB,SAEjD,IACApC,KAAA,WAAA,OAAAJ,QAAAnB,QAGIkF,EAAKhF,MAAMhC,KAAK,sBAAkBmG,EAAW,IAC3Ca,EAAK2J,oBACXtN,uBAAAJ,QAAAnB,QAEIkF,EAAKhF,MAAMhC,KAAK,YAAa,CAAExD,IAAKwK,EAAKzB,eAAgB+K,MAAO3R,SAAS2R,SAAQjN,KAGnF,WAAC2D,EAAK1I,QAAQoQ,OACjB1H,EAAK0H,MAAMtM,OAEb,EAAA,EAAA,IA5CEa,QAAAnB,SA4CF,CAAC,MAAAiF,GAAA,OAAA9D,QAAAuF,OAAAzB,EAAA,CAAA,EC/BYsK,EAAM,SAAsBC,GANnBC,MAOrB,GAPqBA,EAOHD,EALXC,GAAoBC,cAW3B,GADAF,EAAOjQ,KAAOP,MACVwQ,EAAOG,oBACLH,EAAOG,qBAWb,OAPIH,EAAOI,cACVJ,EAAOI,eAERJ,EAAOK,QAEP7Q,KAAK8Q,QAAQjI,KAAK2H,GAEXxQ,KAAK8Q,aAjBXnK,QAAQC,MAAM,6BAA8B4J,EAkB9C,EAGgB,SAAAO,EAAkBC,GACjC,MAAMR,EAASxQ,KAAKiR,WAAWD,GAC/B,GAAKR,EAYL,OAPAA,EAAOU,UACHV,EAAOW,eACVX,EAAOW,gBAGRnR,KAAK8Q,QAAU9Q,KAAK8Q,QAAQ7M,OAAQmN,GAAMA,IAAMZ,QAEpCM,QAXXnK,QAAQC,MAAM,iBAAkB4J,EAYlC,CAGM,SAAUS,EAAuBD,GACtC,YAAYF,QAAQO,KAClBb,GACAA,IAAWQ,GACXR,EAAO7L,OAASqM,GAChBR,EAAO7L,cAAgBqM,IAE1B,CCrEM,SAAUtP,EAAuBhG,GACtC,GAAuC,mBAAxBsE,KAACxC,QAAQkE,WAEvB,OADAiF,QAAQI,KAAK,0DACNrL,EAER,MAAMuF,EAASjB,KAAKxC,QAAQkE,WAAWhG,GACvC,OAAKuF,GAA4B,iBAAXA,EAIlBA,EAAOoD,WAAW,OAASpD,EAAOoD,WAAW,SAChDsC,QAAQI,KAAK,4DACNrL,GAEDuF,GAPN0F,QAAQI,KAAK,mDACNrL,EAOT,CAQgB,SAAA4U,EAA8BgB,EAAcC,GAC3D,OAAWvR,KAAC0B,WAAW4P,KAAUtR,KAAK0B,WAAW6P,EAClD,CCkBA,MAAMC,EAAoB,CACzBC,wBAAwB,EACxBxM,kBAAmB,yBACnBD,eAAgB,OAChB4I,OAAO,EACPrK,WAAY,CAAC,SACbmO,YAAa,SAAChW,EAAGN,GAAA,IAAE8E,GAAEA,QAAW,IAAA9E,EAAG,CAAE,EAAAA,EAAA,QAAO8E,GAAIrB,QAAQ,iBAAiB,EACzE8S,aAAc,UACdb,QAAS,GACTpP,WAAahG,GAAQA,EACrB8S,eAAgB,CACf,mBAAoB,OACpBoD,OAAU,oCAEXzD,qBAAuB7P,GAAkC,SAAxBA,EAAMnC,OAAOJ,qBAkE9C6D,WAAAA,CAAYpC,YAAAA,IAAAA,EAA4B,CAAE,QA5DjCqU,gBAAyB7R,KAElCxC,aAESgU,EAAAA,KAAAA,SAAoBA,OAE7BV,QAAoB,GAAE9Q,KAEtBqD,WAAK,EAAArD,KAEI4N,WAAK,EAAA5N,KAELkB,WAEAiM,EAAAA,KAAAA,aAET1I,EAAAA,KAAAA,eAAyBtJ,IAAe6E,KAE9BgO,oBAAsB,EAEtB8D,KAAAA,0BAGVvB,IAAMA,EAAGvQ,KAET+Q,MAAQA,EAERE,KAAAA,WAAaA,EAAUjR,KAGvB+R,IAAgD,OAGhD1D,KAAAA,SAAWA,EAEDpB,KAAAA,kBAAoBA,EAAiBjN,KAErCsE,YAAcA,EAExBjH,KAAAA,cAAgBA,OAEhByQ,UAAYA,EAAS9N,KAErB0K,gBAAkBA,EACR8C,KAAAA,WAAaA,EAAUxN,KAEjCoP,eAAiBA,EACP3B,KAAAA,cAAgBA,OAChBH,eAAiBA,EAActN,KAC/B6P,gBAAkBA,EAAe7P,KAE3CmK,iBAAmBA,EAGnBhP,KAAAA,cAAgBA,EAAa6E,KAE7B0B,WAAaA,EAEH4O,KAAAA,kBAAoBA,EAI7BtQ,KAAKxC,QAAU,IAAKwC,KAAKwR,YAAahU,GAEtCwC,KAAKgS,gBAAkBhS,KAAKgS,gBAAgBpM,KAAK5F,MACjDA,KAAKiS,eAAiBjS,KAAKiS,eAAerM,KAAK5F,MAE/CA,KAAK4N,MAAQ,IAAItN,EAAMN,MACvBA,KAAKmN,QAAU,IAAIlK,EAAQjD,MAC3BA,KAAKkB,MAAQ,IAAImF,EAAMrG,MACvBA,KAAKqD,MAAQrD,KAAKsE,YAAY,CAAEE,QAAIa,IAE/BrF,KAAKkS,qBAIVlS,KAAKmS,QACN,CAEUD,iBAAAA,GACT,MAAuB,oBAAZ/P,UACVwE,QAAQI,KAAK,+BAIf,CAGMoL,MAAAA,GAAM,IAAAjM,MAAAA,EAEclG,MAAnB2R,aAAEA,GAAiBzL,EAAK1I,QAeU,OAdxC0I,EAAK4L,cAAgB5L,EAAK7I,cAAcsU,EAAc,QAASzL,EAAK8L,iBAEpEtP,OAAOpD,iBAAiB,WAAY4G,EAAK+L,gBASzC/L,EAAK1I,QAAQsT,QAAQjQ,QAAS2P,GAAWtK,EAAKqK,IAAIC,IAGlDtU,EAAoB,KAAM,CAAEyN,MAAO,IAAKxH,QAAAnB,QAGlCkB,KAAUK,KAAA,WAAA,OAAAJ,QAAAnB,QAGVkF,EAAKhF,MAAMhC,KAAK,cAAUmG,EAAW,KAE1CxH,SAASK,gBAAgB0F,UAAUzG,IAAI,eAAc,IACpDoF,KAAA,WAAA,EAAA,EACH,CAAC,MAAA0D,GAAA9D,OAAAA,QAAAuF,OAAAzB,EAAA,CAAA,CAGKzG,OAAAA,GAAO,IAAAqI,MAAAA,EAEZ7H,KAS6D,OAT7D6H,EAAKiK,cAAetS,UAGpBkD,OAAOvD,oBAAoB,WAAY0I,EAAKoK,gBAG5CpK,EAAK+F,MAAMtM,QAGXuG,EAAKrK,QAAQsT,QAAQjQ,QAAS2P,GAAW3I,EAAKkJ,MAAMP,IAASrO,QAAAnB,QAGvD6G,EAAK3G,MAAMhC,KAAK,eAAWmG,EAAW,KAE3CxH,SAASK,gBAAgB0F,UAAUE,OAAO,eAAc,IACvDvB,KAAA,WAGFsF,EAAK3G,MAAMI,OAAQ,EACpB,CAAC,MAAA2E,GAAA,OAAA9D,QAAAuF,OAAAzB,EAGDqI,CAAAA,CAAAA,iBAAAA,CAAkBnO,EAAYiN,GAAE,IAAAlN,GAAEA,EAAE5B,MAAEA,QAA2C,MAAA,CAAA,EAAE8O,EAClF,MAAMgF,OAAEA,EAAM1W,IAAEA,EAAGL,KAAEA,GAASqE,EAASW,QAAQF,GAG/C,OAAIiS,IAAW1P,OAAOpH,SAAS8W,WAK3BlS,IAAMF,KAAKqS,yBAAyBnS,OAKpCF,KAAKxC,QAAQkU,YAAYhW,EAAML,EAAM,CAAE6E,KAAI5B,SAMhD,CAEU0T,eAAAA,CAAgB1T,GACzB,MAAM4B,EAAK5B,EAAMC,gBACX4B,KAAEA,EAAIzE,IAAEA,EAAGL,KAAEA,GAASqE,EAASO,YAAYC,GAG7CF,KAAKsO,kBAAkBnO,EAAM,CAAED,KAAI5B,YAIvC0B,KAAKqD,MAAQrD,KAAKsE,YAAY,CAAEE,GAAI9I,EAAKL,OAAM6E,KAAI5B,UAG/CA,EAAMgU,SAAWhU,EAAMiU,SAAWjU,EAAMkU,UAAYlU,EAAMmU,OAC7DzS,KAAKkB,MAAMhC,KAAK,cAAe,CAAEiB,SAKb,IAAjB7B,EAAMoU,QAIV1S,KAAKkB,MAAMC,SAAS,aAAc,CAAEjB,KAAI5B,SAAS,KAChD,MAAM0D,EAAOhC,KAAKqD,MAAMrB,KAAKtG,KAAO,GAEpC4C,EAAMqU,iBAGDjX,GAAOA,IAAQsG,EAehBhC,KAAKsQ,kBAAkB5U,EAAKsG,IAKhChC,KAAKiN,kBAAkBvR,GAnBlBL,EACH2E,KAAKkB,MAAMC,SAAS,cAAe,CAAE9F,QAAQ,KAC5Ca,EAAoBR,EAAML,GAC1B2E,KAAK6P,iBACN,GAEA7P,KAAKkB,MAAMC,SAAS,iBAAakE,EAAW,KAC3CrF,KAAK6P,iBACN,EAYH,GACD,CAEUoC,cAAAA,CAAe3T,GACxB,MAAM6B,EAAO7B,EAAMnC,OAAOT,KAAOJ,SAAS6E,KAG1C,GAAIH,KAAKxC,QAAQ2Q,qBAAqB7P,GACrC,OAID,GAAI0B,KAAKsQ,kBAAkBnV,IAAiB6E,KAAKyE,gBAChD,OAID,GAAIzE,KAAKsO,kBAAkBnO,EAAM,CAAE7B,UAClC,OAGD,MAAM5C,IAAEA,EAAGL,KAAEA,GAASqE,EAASW,QAAQF,GAIvCH,KAAKqD,MAAQrD,KAAKsE,YAAY,CAC7BE,GAAI9I,EACJL,OACAiD,QACAoG,QAPe1E,KAAKxC,QAAQiU,uBAQ5B5M,YAPmB7E,KAAKxC,QAAQiU,yBAWjCzR,KAAKqD,MAAMrH,QAAQmJ,UAAW,EAG9B,MAAMwE,EAAQ5G,OAAOzE,EAAMnC,OAAOwN,OAC9BA,IAEH3J,KAAKqD,MAAMrH,QAAQoJ,UADDuE,EAAQ3J,KAAKgO,oBAAsB,EAAI,WAAa,aASvEhO,KAAKkB,MAAMC,SAAS,mBAAoB,CAAE7C,SAAS,KAClD0B,KAAKiN,kBAAkBvR,EACxB,EACD,CAGU2W,wBAAAA,CAAyBO,GAClC,QAAIA,EAAUC,QAAQ,gCAIvB"}